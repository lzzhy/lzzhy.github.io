<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">










  <meta name="baidu-site-verification" content="true">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar1.jpeg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar1.jpeg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="lzzhy Blog">
<meta property="og:url" content="https://lzzhy.cn/index.html">
<meta property="og:site_name" content="lzzhy Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lzzhy Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://lzzhy.cn/">





  <title>lzzhy Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">lzzhy Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">lzzhy的博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>





  <meta name="baidu-site-verification" content="V5nnDAPNHd">

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/vite+vue3+ts 从0开始搭建基础框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/vite+vue3+ts 从0开始搭建基础框架/" itemprop="url">vite+vue3+ts 从0开始搭建基础框架</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-30T16:52:40+08:00">
                2021-05-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/vite+vue3+ts 从0开始搭建基础框架/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/vite+vue3+ts 从0开始搭建基础框架/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  6.4k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Vue3 跟 Vite 正式版发布有很长一段时间了，生态圈也渐渐丰富起来。总结一下：就是快！也不用担心稳定性问题，开发体验真不是一般好！我们一起尝试从本文开始学习吧，从 0 开始手把手搭建一套基于 Vite + Vue3 + TypeScript 规范的前端工程化项目环境。</p>
<p>本文主要从以下几个方面展开来说：</p>
<ul>
<li>架构搭建（后期规范后会整理成脚手架）</li>
<li>代码规范</li>
<li>提交规范</li>
</ul>
<p>本项目完整代码托管在<a href="https://github.com/lzzhy/vue3-ts-ant-design" target="_blank" rel="noopener">github</a>上，欢迎有兴趣的同学去点亮小星星！！！</p>
<p>本文所用到的技术栈如下：</p>
<ul>
<li>编程语言：TypeScript 4.x + JavaScript</li>
<li>架构工具：Vite 2.x</li>
<li>前端框架：前端框架：Vue 3.x</li>
<li>路由工具：Vue Router 4.x</li>
<li>状态管理：Vuex 4.x</li>
<li>UI框架：ant design vue 2.x</li>
<li>CSS 预编译：less</li>
<li>HTTP 工具：Axios</li>
<li>Git Hook 工具：husky + lint-staged</li>
<li>代码规范：EditorConfig + Prettier + ESLint + Airbnb JavaScript Style Guide</li>
<li>提交规范：Commitizen + Commitlint</li>
</ul>
<p>好的，项目选型工作做好后，那就开始我们的Coding之旅吧。。。。</p>
<h2 id="架构搭建"><a href="#架构搭建" class="headerlink" title="架构搭建"></a>架构搭建</h2><h3 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h3><p>请确保你的电脑上成功安装 Node.js，本项目使用 Vite 构建工具，需要 Node.js 版本 &gt;= 12.0.0。</p>
<p>查看 Node.js 版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<p>建议将 Node.js 升级到最新的稳定版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 使用 nvm 安装最新稳定版 Node.js</span><br><span class="line">nvm install stable</span><br></pre></td></tr></table></figure>

<p>依赖用npm安装(cnpm的镜像源不同，安装出来的包也不一样)，版本要求6.以上</p>
<p>vue-cli 版本最好4.5以上（查看版本： vue -V，更新命令：npm install -g @vue/cli）(使用vue-cli时要求)</p>
<h3 id="使用-Vite-快速初始化项目雏形"><a href="#使用-Vite-快速初始化项目雏形" class="headerlink" title="使用 Vite 快速初始化项目雏形"></a>使用 Vite 快速初始化项目雏形</h3><p>使用NPM：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init @vitejs/app</span><br></pre></td></tr></table></figure>

<p>或者使用Yarn：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create @vitejs/app</span><br></pre></td></tr></table></figure>

<p>然后按照终端提示完成操作，选择完后如下：（是不是炒鸡快！！！）</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG34.png" alt="cmd-markdown-logo"></p>
<p>你还可以通过附加的命令行选项直接指定项目名和模板，本项目要构建 Vite + Vue3 + TypeScript 项目，则运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># npm 6.x</span><br><span class="line">npm init @vitejs/app vite-vue3-ts --template vue-ts    // vite-vue3-ts是我的项目名称</span><br><span class="line"></span><br><span class="line"># npm 7+（需要额外的双横线）</span><br><span class="line">npm init @vitejs/app vite-vue3-ts -- --template vue-ts</span><br><span class="line"></span><br><span class="line"># yarn</span><br><span class="line">yarn create @vitejs/app vite-vue3-ts --template vue-ts</span><br></pre></td></tr></table></figure>

<p>完了后，cd vite-vue3-ts 可以看到生成的基础目录：</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG35.png" alt="cmd-markdown-logo"></p>
<p>安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>启动项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG36.png" alt="cmd-markdown-logo"></p>
<p>整个运行过程也是很快只用了不到1s。果然Vite速度没的说。。。</p>
<p>如上图，表示 Vite + Vue3 + TypeScript 简单的项目骨架搭建完毕，下面我们来为这个项目集成 Vue Router、Vuex、Ant Design Vue、Axios、Less。</p>
<h3 id="修改-Vite-配置文件"><a href="#修改-Vite-配置文件" class="headerlink" title="修改 Vite 配置文件"></a>修改 Vite 配置文件</h3><p>Vite 配置文件 <code>vite.config.ts</code> 位于根目录下，项目启动时会自动读取。</p>
<p>本项目先做一些简单配置，例如：设置 @ 指向 src 目录、 服务启动端口、打包路径、代理等。</p>
<p>关于 Vite 更多配置项及用法，请查看 Vite 官网 <a href="https://vitejs.dev/config/" target="_blank" rel="noopener">https://vitejs.dev/config/</a> 。</p>
<p>vite.config.ts：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import &#123; defineConfig &#125; from &quot;vite&quot;;</span><br><span class="line">import vue from &quot;@vitejs/plugin-vue&quot;;</span><br><span class="line">// 如果编辑器提示 path 模块找不到，则可以安装一下 @types/node -&gt; npm i @types/node -D</span><br><span class="line">import &#123; resolve &#125; from &quot;path&quot;;</span><br><span class="line"></span><br><span class="line">// https://vitejs.dev/config/</span><br><span class="line">export default defineConfig(&#123;</span><br><span class="line">  plugins: [vue()],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      &quot;@&quot;: resolve(__dirname, &quot;src&quot;), // 设置 `@` 指向 `src` 目录</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  base: &quot;./&quot;, // 设置打包路径</span><br><span class="line">  server: &#123;</span><br><span class="line">    port: 4000, // 设置服务启动端口号</span><br><span class="line">    open: true, // 设置服务启动时是否自动打开浏览器</span><br><span class="line">    cors: true, // 允许跨域</span><br><span class="line"></span><br><span class="line">    // 设置代理，根据我们项目实际情况配置</span><br><span class="line">    // proxy: &#123;</span><br><span class="line">    //   &apos;/api&apos;: &#123;</span><br><span class="line">    //     target: &apos;http://xxx.xxx.xxx.xxx:8000&apos;,</span><br><span class="line">    //     changeOrigin: true,</span><br><span class="line">    //     secure: false,</span><br><span class="line">    //     rewrite: (path) =&gt; path.replace(&apos;/api/&apos;, &apos;/&apos;)</span><br><span class="line">    //   &#125;</span><br><span class="line">    // &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="规范目录结构"><a href="#规范目录结构" class="headerlink" title="规范目录结构"></a>规范目录结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">├── publish/</span><br><span class="line">└── src/</span><br><span class="line">    ├── assets/                    // 静态资源目录</span><br><span class="line">    ├── common/                    // 通用类库目录</span><br><span class="line">    ├── components/                // 公共组件目录</span><br><span class="line">    ├── router/                    // 路由配置目录</span><br><span class="line">    ├── store/                     // 状态管理目录</span><br><span class="line">    ├── style/                     // 通用 CSS 目录</span><br><span class="line">    ├── utils/                     // 工具函数目录</span><br><span class="line">    ├── views/                     // 页面组件目录</span><br><span class="line">    ├── App.vue</span><br><span class="line">    ├── main.ts</span><br><span class="line">    ├── shims-vue.d.ts</span><br><span class="line">├── tests/                         // 单元测试目录</span><br><span class="line">├── index.html</span><br><span class="line">├── tsconfig.json                  // TypeScript 配置文件</span><br><span class="line">├── vite.config.ts                 // Vite 配置文件</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>

<h3 id="集成路由工具-Vue-Router"><a href="#集成路由工具-Vue-Router" class="headerlink" title="集成路由工具 Vue Router"></a>集成路由工具 Vue Router</h3><p>安装支持 Vue3 的路由工具 vue-router@4：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-router@4</span><br></pre></td></tr></table></figure>

<p>创建 src/router/index.ts 文件：（路由配置文件）<br>  在 src 下创建 router 目录，然后在 router 目录里新建 index.ts 文件</p>
<p>index.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  createRouter,</span><br><span class="line">  createWebHashHistory,</span><br><span class="line">  RouteRecordRaw,</span><br><span class="line">&#125; from &quot;vue-router&quot;;</span><br><span class="line">import Home from &quot;@/views/home.vue&quot;;</span><br><span class="line">import Vuex from &quot;@/views/vuex.vue&quot;;</span><br><span class="line"></span><br><span class="line">const routes: Array&lt;RouteRecordRaw&gt; = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/&quot;,</span><br><span class="line">    name: &quot;Home&quot;,</span><br><span class="line">    component: Home,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/vuex&quot;,</span><br><span class="line">    name: &quot;Vuex&quot;,</span><br><span class="line">    component: Vuex,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/axios&quot;,</span><br><span class="line">    name: &quot;Axios&quot;,</span><br><span class="line">    component: () =&gt; import(&quot;@/views/axios.vue&quot;), // 懒加载组件</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">const router = createRouter(&#123;</span><br><span class="line">  history: createWebHashHistory(),</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default router;</span><br></pre></td></tr></table></figure>

<p>根据本项目路由配置的实际情况，需要在 src 下创建 views 目录，用来存储页面组件。并在 views 目录下创建 home.vue 、vuex.vue 、axios.vue。</p>
<p>在 <code>main.ts</code> 文件中挂载路由配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &quot;vue&quot;;</span><br><span class="line">import App from &quot;./App.vue&quot;;</span><br><span class="line"></span><br><span class="line">import router from &quot;./router/index&quot;;</span><br><span class="line"></span><br><span class="line">createApp(App).use(router).mount(&quot;#app&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="集成状态管理工具-Vuex"><a href="#集成状态管理工具-Vuex" class="headerlink" title="集成状态管理工具 Vuex"></a>集成状态管理工具 Vuex</h3><p>安装支持 Vue3 的状态管理工具 vuex@next</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vuex@next</span><br></pre></td></tr></table></figure>

<p>创建 src/store/index.ts 文件。在 src 下创建 store 目录，然后在 store 目录里新建 index.ts 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from &quot;vuex&quot;;</span><br><span class="line"></span><br><span class="line">const defaultState = &#123;</span><br><span class="line">  count: 0,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// Create a new store instance.</span><br><span class="line">export default createStore(&#123;</span><br><span class="line">  state() &#123;</span><br><span class="line">    return defaultState;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    increment(state: typeof defaultState) &#123;</span><br><span class="line">      state.count++;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment(context) &#123;</span><br><span class="line">      context.commit(&quot;increment&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    double(state: typeof defaultState) &#123;</span><br><span class="line">      return 2 * state.count;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在 <code>main.ts</code> 文件中挂载 Vuex 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &quot;vue&quot;;</span><br><span class="line">import App from &quot;./App.vue&quot;;</span><br><span class="line"></span><br><span class="line">import store from &quot;./store/index&quot;;</span><br><span class="line"></span><br><span class="line">createApp(App).use(store).mount(&quot;#app&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="项目创建-vue-cli"><a href="#项目创建-vue-cli" class="headerlink" title="项目创建 vue-cli"></a>项目创建 vue-cli</h3><p>以上那些是使用vite创建的流程，同时也可以使用vue-cli来进行创建，使用vue-cli时可以自行选择以上所需要的那些vue-router,vuex… vue-cli都已经集成了不需要大家在自己去写一次了。但是如果是第一次接触到vue3建议还是使用vite按照以上流程自己走一遍，能更好的明白vue3其中的一些配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名</span><br></pre></td></tr></table></figure>

<p>自定义选配置</p>
<p>新建项目时报错：Error: Cannot find module ‘vue-loader-v16/package.json’（微信有图）</p>
<p>解决方式：</p>
<ul>
<li>首先检查一下node、npm和vue-cli这些版本是不是需要的那些版本</li>
<li>重装依赖npm install</li>
</ul>
<h3 id="集成UI框架-ant-design-vue"><a href="#集成UI框架-ant-design-vue" class="headerlink" title="集成UI框架 ant design vue"></a>集成UI框架 ant design vue</h3><p>ant-design-vue只有2.以上版本才支持vue3</p>
<p>全局引入</p>
<p>安装支持vue3的ant design vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save ant-design-vue@next</span><br></pre></td></tr></table></figure>

<p>在 <code>main.ts</code> 文件中挂载 Vuex 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &apos;vue&apos;;</span><br><span class="line">import Antd from &apos;ant-design-vue&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import &apos;ant-design-vue/dist/antd.css&apos;;</span><br><span class="line"></span><br><span class="line">const app = createApp();</span><br><span class="line">app.config.productionTip = false;</span><br><span class="line"></span><br><span class="line">app.use(Antd);</span><br></pre></td></tr></table></figure>

<p>在页面中能使用ant-design-vue组件的话就说明引入成功</p>
<p>【ant-design-vue官网】：<a href="https://2x.antdv.com/docs/vue/getting-started-cn" target="_blank" rel="noopener">https://2x.antdv.com/docs/vue/getting-started-cn</a></p>
<h3 id="集成-HTTP-工具-Axios"><a href="#集成-HTTP-工具-Axios" class="headerlink" title="集成 HTTP 工具 Axios"></a>集成 HTTP 工具 Axios</h3><p>安装 Axios（Axios 跟 Vue 版本没有直接关系，安装最新即可）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i axios</span><br></pre></td></tr></table></figure>

<p>配置 Axios</p>
<blockquote>
<p>为了使项目的目录结构合理且规范，我们在 src 下创建 utils 目录来存储我们常用的工具函数。</p>
</blockquote>
<p>Axios 作为 HTTP 工具，我们在 utils 目录下添加 axios.ts 文件 作为 Axios 配置文件：</p>
<p>axios.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import Axios from &quot;axios&quot;;</span><br><span class="line"></span><br><span class="line">const baseURL = &quot;https://api.github.com&quot;;</span><br><span class="line"></span><br><span class="line">const axios = Axios.create(&#123;</span><br><span class="line">  baseURL,</span><br><span class="line">  timeout: 20000, // 请求超时 20s</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 前置拦截器（发起请求之前的拦截）</span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">  (response) =&gt; &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 根据你的项目实际情况来对 config 做处理</span><br><span class="line">     * 这里对 config 不做任何处理，直接返回</span><br><span class="line">     */</span><br><span class="line">    return response;</span><br><span class="line">  &#125;,</span><br><span class="line">  (error) =&gt; &#123;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 后置拦截器（获取到响应时的拦截）</span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">  (response) =&gt; &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 根据你的项目实际情况来对 response 和 error 做处理</span><br><span class="line">     * 这里对 response 和 error 不做任何处理，直接返回</span><br><span class="line">     */</span><br><span class="line">    return response;</span><br><span class="line">  &#125;,</span><br><span class="line">  (error) =&gt; &#123;</span><br><span class="line">    if (error.response &amp;&amp; error.response.data) &#123;</span><br><span class="line">      const code = error.response.status;</span><br><span class="line">      const msg = error.response.data.message;</span><br><span class="line">      console.log(code,&apos;Message&apos;,msg)</span><br><span class="line">      console.error(`[Axios Error]`, error.response);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      console.log(&apos;error&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">export default axios;</span><br></pre></td></tr></table></figure>

<p>使用 Axios.在需要使用 Axios 文件里，引入 Axios 配置文件，参考如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">  import &#123; defineComponent &#125; from &quot;vue&quot;;</span><br><span class="line">  import axios from &quot;../utils/axios&quot;;</span><br><span class="line"></span><br><span class="line">  export default defineComponent(&#123;</span><br><span class="line">    setup() &#123;</span><br><span class="line">      axios</span><br><span class="line">        .get(&quot;/users/XPoet&quot;)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">          console.log(&quot;res: &quot;, res);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) =&gt; &#123;</span><br><span class="line">          console.log(&quot;err: &quot;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="集成-CSS-预编译器-Stylus-Sass-Less"><a href="#集成-CSS-预编译器-Stylus-Sass-Less" class="headerlink" title="集成 CSS 预编译器 Stylus/Sass/Less"></a>集成 CSS 预编译器 Stylus/Sass/Less</h3><p>本项目使用 CSS 预编译器 less 内部已帮我们集成了相关的 loader，不需要额外配置。同理，你也可以使用 Sass 或 Stylus 等。</p>
<p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i less-loader less --save-dev</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;less&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>至此，一个基于 TypeScript + Vite + Vue3 + Vue Router + Vuex + Ant Design Vue + Axios + Stylus/Sass/Less 的前端项目开发环境搭建完毕，项目 Demo 托管在 <a href="https://github.com/lzzhy/vue3-ts-ant-design" target="_blank" rel="noopener">github</a> 仓库，需要的同学可以去下载下来，参考学习。</p>
<p>下面我们来打磨这个项目，增加代码规范约束、提交规范约束、单元测试、自动部署等，让其更完善、更健壮。</p>
<h2 id="代码规范"><a href="#代码规范" class="headerlink" title="代码规范"></a>代码规范</h2><p>随着前端应用逐渐变得大型化和复杂化，在同一个项目中有多个人员参与时，每个人的前端能力程度不等，他们往往会用不同的编码风格和习惯在项目中写代码，长此下去，势必会让项目的健壮性越来越差。解决这些问题，理论上讲，口头约定和代码审查都可以，但是这种方式无法实时反馈，而且沟通成本过高，不够灵活，更关键的是无法把控。不以规矩，不能成方圆，我们不得不在项目使用一些工具来约束代码规范。</p>
<p>本文讲解如何使用 EditorConfig + Prettier + ESLint 组合来实现代码规范化。</p>
<p>这样做带来好处：</p>
<ul>
<li>解决团队之间代码不规范导致的可读性差和可维护性差的问题。</li>
<li>解决团队成员不同编辑器导致的编码规范不统一问题。</li>
<li>提前发现代码风格问题，给出对应规范提示，及时修复。</li>
<li>减少代码审查过程中反反复复的修改过程，节约时间。</li>
<li>自动格式化，统一编码风格，从此和脏乱差的代码说再见</li>
</ul>
<h3 id="集成-EditorConfig-配置"><a href="#集成-EditorConfig-配置" class="headerlink" title="集成 EditorConfig 配置"></a>集成 EditorConfig 配置</h3><p>EditorConfig 有助于为不同 IDE 编辑器上处理同一项目的多个开发人员维护一致的编码风格</p>
<p>官网：<a href="http://editorconfig.org" target="_blank" rel="noopener">http://editorconfig.org</a></p>
<p>在项目根目录下增加 .editorconfig 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># Editor configuration, see http://editorconfig.org</span><br><span class="line"></span><br><span class="line"># 表示是最顶层的 EditorConfig 配置文件</span><br><span class="line">root = true</span><br><span class="line"></span><br><span class="line">[*] # 表示所有文件适用</span><br><span class="line">charset = utf-8 # 设置文件字符集为 utf-8</span><br><span class="line">indent_style = space # 缩进风格（tab | space）</span><br><span class="line">indent_size = 2 # 缩进大小</span><br><span class="line">end_of_line = lf # 控制换行类型(lf | cr | crlf)</span><br><span class="line">trim_trailing_whitespace = true # 去除行首的任意空白字符</span><br><span class="line">insert_final_newline = true # 始终在文件末尾插入一个新行</span><br><span class="line"></span><br><span class="line">[*.md] # 表示仅 md 文件适用以下规则</span><br><span class="line">max_line_length = off</span><br><span class="line">trim_trailing_whitespace = false</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li><p>VSCode 使用 EditorConfig 需要去插件市场下载插件 EditorConfig for VS Code</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG37.png" alt="cmd-markdown-logo"></p>
</li>
<li><p>JetBrains 系列（WebStorm、IntelliJ IDEA 等）则不用额外安装插件，可直接使用 EditorConfig 配置。</p>
</li>
</ul>
<h3 id="集成-Prettier-配置"><a href="#集成-Prettier-配置" class="headerlink" title="集成 Prettier 配置"></a>集成 Prettier 配置</h3><p>Prettier 是一款强大的代码格式化工具，支持 JavaScript、TypeScript、CSS、SCSS、Less、JSX、Angular、Vue、GraphQL、JSON、Markdown 等语言，基本上前端能用到的文件格式它都可以搞定，是当下最流行的代码格式化工具。</p>
<p>官网：<a href="https://prettier.io/" target="_blank" rel="noopener">https://prettier.io/</a></p>
<p>安装 Prettier</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i prettier -D</span><br></pre></td></tr></table></figure>

<p>创建 Prettier 配置文件,Prettier 支持多种格式的配置文件[27]，比如 .json、.yml、.yaml、.js等。在本项目根目录下创建 .prettierrc 文件。</p>
<p>.prettierrc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;useTabs&quot;: false,</span><br><span class="line">  &quot;tabWidth&quot;: 2,</span><br><span class="line">  &quot;printWidth&quot;: 100,</span><br><span class="line">  &quot;singleQuote&quot;: true,</span><br><span class="line">  &quot;trailingComma&quot;: &quot;none&quot;,</span><br><span class="line">  &quot;bracketSpacing&quot;: true,</span><br><span class="line">  &quot;semi&quot;: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Prettier 安装且配置好之后，就能使用命令来格式化代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 格式化所有文件（. 表示所有文件）</span><br><span class="line">npx prettier --write .</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li><p>VSCode 编辑器使用 Prettier 配置需要下载插件 Prettier - Code formatter </p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG38.png" alt="cmd-markdown-logo"></p>
</li>
</ul>
<ul>
<li>JetBrains 系列编辑器（WebStorm、IntelliJ IDEA 等）则不用额外安装插件，可直接使用 Prettier 配置。</li>
</ul>
<p>Prettier 配置好以后，在使用 VSCode 或 WebStorm 等编辑器的格式化功能时，编辑器就会按照 Prettier 配置文件的规则来进行格式化，避免了因为大家编辑器配置不一样而导致格式化后的代码风格不统一的问题。</p>
<h3 id="集成-ESLint-配置"><a href="#集成-ESLint-配置" class="headerlink" title="集成 ESLint 配置"></a>集成 ESLint 配置</h3><p>正如前面我们提到的因团队成员之间编程能力和编码习惯不同所造成的代码质量问题，我们使用 ESLint 来解决，一边写代码一边查找问题，如果发现错误，就给出规则提示，并且自动修复，长期下去，可以促使团队成员往同一种编码风格靠拢。</p>
<p>安装 ESLint（推荐只在当前项目安装）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i eslint -D</span><br></pre></td></tr></table></figure>

<p>配置 ESLint：ESLint 安装成功后，执行 npx eslint –init，然后按照终端操作提示完成一系列设置来创建配置文件。</p>
<p>ESLint 为我们列出了三种社区流行的 JavaScript 风格指南，分别是 <a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">airbnb</a>、<a href="https://github.com/standard/standard" target="_blank" rel="noopener">airbnb</a>、Google。</p>
<p>这三份风格指南都是由众多大佬根据多年开发经验编写，足够优秀，全球很多大小公司都在使用。我们选用 GitHub 上 star 最多的 Airbnb，免去繁琐的配置 ESLint 规则时间，然后让团队成员去学习 Airbnb JavaScript 风格指南即可。</p>
<p>注： 在使用vue-cli安装项目时它内部有对eslint集成，会对ESlint提问也就是以上提供的三个选择，任选一个就行</p>
<p><code>这里作者不建议大家去自由配置 ESLint 规则，这三份 JavaScript 代码风格指南值得我们反复学习，掌握后，编程能力能上一大台阶。</code></p>
<p>在上面操作完成后，会在项目根目录下自动生成 .eslintrc.js 配置文件：</p>
<p>.eslintrc.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: true,</span><br><span class="line">    es2021: true,</span><br><span class="line">    node: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [&quot;plugin:vue/essential&quot;, &quot;airbnb-base&quot;],</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaVersion: 12,</span><br><span class="line">    parser: &quot;@typescript-eslint/parser&quot;,</span><br><span class="line">    sourceType: &quot;module&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [&quot;vue&quot;, &quot;@typescript-eslint&quot;],</span><br><span class="line">  rules: &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>根据项目实际情况，如果我们有额外的 ESLint 规则，也在此文件中追加。</p>
<p>注意：</p>
<ul>
<li><p>VSCode 使用 ESLint 配置文件需要去插件市场下载插件 ESLint<br><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG39.png" alt="cmd-markdown-logo"></p>
</li>
<li><p>JetBrains 系列（WebStorm、IntelliJ IDEA 等）则不用额外安装插件</p>
</li>
</ul>
<p>现在编辑器已经给出错误提示和修复方案，但需要我们一个一个去点击修复，还是挺麻烦的。很简单，我们只需设置编辑器保存文件时自动执行 eslint –fix 命令进行代码风格修复。</p>
<p>VSCode 在 settings.json 设置文件中，增加以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;editor.codeActionsOnSave&quot;: &#123;</span><br><span class="line">    &quot;source.fixAll.eslint&quot;: true</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决-Prettier-和-ESLint-的冲突"><a href="#解决-Prettier-和-ESLint-的冲突" class="headerlink" title="解决 Prettier 和 ESLint 的冲突"></a>解决 Prettier 和 ESLint 的冲突</h3><p>实际项目中的 ESLint 和 Prettier 配置规则，难免会存在规则冲突情况。</p>
<p>解决两者冲突问题，需要用到 eslint-plugin-prettier 和 eslint-config-prettier</p>
<ul>
<li>eslint-plugin-prettier 将 Prettier 的规则设置到 ESLint 的规则中</li>
<li>eslint-config-prettier 关闭 ESLint 中与 Prettier 中会发生冲突的规则</li>
</ul>
<p>最后形成优先级：Prettier 配置规则 &gt; ESLint 配置规则</p>
<p>安装插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i eslint-plugin-prettier eslint-config-prettier -D</span><br></pre></td></tr></table></figure>

<p>在 .eslintrc.js 添加 prettier 插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  extends: [</span><br><span class="line">    &apos;plugin:vue/essential&apos;,</span><br><span class="line">    &apos;airbnb-base&apos;,</span><br><span class="line">    &apos;plugin:prettier/recommended&apos; // 添加 prettier 插件</span><br><span class="line">  ],</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们在执行 eslint –fix 命令时，ESLint 就会按照 Prettier 的配置规则来格式化代码，轻松解决二者冲突问题。</p>
<h3 id="集成-husky-和-lint-staged"><a href="#集成-husky-和-lint-staged" class="headerlink" title="集成 husky 和 lint-staged"></a>集成 husky 和 lint-staged</h3><p>我们还需要做一些限制，让没通过 ESLint 检测和修复的代码禁止提交，从而保证仓库代码都是符合规范的。</p>
<p>为了解决这个问题，我们需要用到 Git Hook，在本地执行 git commit 的时候，就对所提交的代码进行 ESLint 检测和修复（即执行 eslint –fix），如果这些代码没通过 ESLint 规则校验，则禁止提交。</p>
<p>实现这一功能，我们借助 husky + lint-staged</p>
<blockquote>
<p>husky —— Git Hook 工具，可以设置在 git 各个阶段（pre-commit、commit-msg、pre-push 等）触发我们的命令。</p>
<p>lint-staged —— 在 git 暂存的文件上运行 linters。</p>
</blockquote>
<h4 id="配置-husky-自动配置"><a href="#配置-husky-自动配置" class="headerlink" title="配置 husky (自动配置)"></a>配置 husky (自动配置)</h4><p>使用 husky-init 命令快速在项目初始化一个 husky 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky-init &amp;&amp; npm install</span><br></pre></td></tr></table></figure>

<blockquote>
<p>特别注意：本项目使用 husky 6.x 版本，6.x 版本配置方式跟之前的版本有较大差异。目前网上大部分有关 husky 的教程都是 6 以前的版本 ，跟本文教程不太一样，当发现配置方法不一致时，一切以 husky 官网为准。</p>
</blockquote>
<p>到这里，husky 配置完毕，现在我们来使用它</p>
<p>husky 包含很多 hook（钩子），常用有：pre-commit、commit-msg、pre-push。这里，我们使用 pre-commit 来触发 ESLint 命令。</p>
<p>修改 .husky/pre-commit hook 文件的触发命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eslint --fix ./src --ext .vue,.js,.ts</span><br></pre></td></tr></table></figure>

<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG40.png" alt="cmd-markdown-logo"></p>
<p>上面这个 pre-commit hook 文件的作用是：当我们执行 git commit -m “xxx” 时，会先对 src 目录下所有的 .vue、.js、.ts 文件执行 eslint –fix 命令，如果 ESLint 通过，成功 commit，否则终止 commit。</p>
<p>但是又存在一个问题：有时候我们明明只改动了一两个文件，却要对所有的文件执行 eslint –fix。假如这是一个历史项目，我们在中途配置了 ESLint 规则，那么在提交代码时，也会对其他未修改的“历史”文件都进行检查，可能会造成大量文件出现 ESLint 错误，显然不是我们想要的结果。</p>
<p>我们要做到只用 ESLint 修复自己此次写的代码，而不去影响其他的代码。所以我们还需借助一个神奇的工具 lint-staged 。</p>
<h4 id="配置-lint-staged"><a href="#配置-lint-staged" class="headerlink" title="配置 lint-staged"></a>配置 lint-staged</h4><p>lint-staged 这个工具一般结合 husky 来使用，它可以让 husky 的 hook 触发的命令只作用于 git add那些文件（即 git 暂存区的文件），而不会影响到其他文件。</p>
<p>接下来，我们使用 lint-staged 继续优化项目。</p>
<p>安装 lint-staged</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i lint-staged -D</span><br></pre></td></tr></table></figure>

<p>在 package.json里增加 lint-staged 配置项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;lint-staged&quot;: &#123;</span><br><span class="line">  &quot;*.&#123;vue,js,ts&#125;&quot;: &quot;eslint --fix&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG41.png" alt="cmd-markdown-logo"></p>
<p>这行命令表示：只对 git 暂存区的 .vue、.js、.ts 文件执行 eslint –fix</p>
<p>修改 .husky/pre-commit hook 的触发命令为：npx lint-staged</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG42.png" alt="cmd-markdown-logo"></p>
<p>至此，husky 和 lint-staged 组合配置完成</p>
<p>最后提交代码时就只会对当前提交的这些代码commit时进行校验，符合eslint则提交不符合则报错。</p>
<h2 id="提交规范"><a href="#提交规范" class="headerlink" title="提交规范"></a>提交规范</h2><p>多人协作的项目中，在提交代码这个环节，也存在一种情况：不能保证每个人对提交信息的准确描述，因此会出现提交信息紊乱、风格不一致的情况。</p>
<p>这里，我们使用社区最流行、最知名、最受认可的 Angular 团队提交规范。如：</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG43.png" alt="cmd-markdown-logo"></p>
<p>那我们的话就大致统一一下就不分的这么细了：</p>
<table>
<thead>
<tr>
<th>值</th>
<th align="right">描述</th>
</tr>
</thead>
<tbody><tr>
<td>feat</td>
<td align="right">新增一个功能</td>
</tr>
<tr>
<td>fix</td>
<td align="right">修复一个 Bug</td>
</tr>
<tr>
<td>docs</td>
<td align="right">文档变更</td>
</tr>
<tr>
<td>style</td>
<td align="right">代码格式（不影响功能，例如空格、分号等格式修正）</td>
</tr>
<tr>
<td>refactor</td>
<td align="right">代码重构</td>
</tr>
<tr>
<td>perf</td>
<td align="right">改善性能</td>
</tr>
<tr>
<td>test</td>
<td align="right">测试</td>
</tr>
<tr>
<td>build</td>
<td align="right">变更项目构建或外部依赖（例如 scopes: webpack、gulp、npm 等）</td>
</tr>
<tr>
<td>ci</td>
<td align="right">更改持续集成软件的配置文件和 package 中的 scripts 命令，例如 scopes: Travis, Circle 等</td>
</tr>
<tr>
<td>chore</td>
<td align="right">变更构建流程或辅助工具</td>
</tr>
<tr>
<td>revert</td>
<td align="right">代码回退</td>
</tr>
</tbody></table>
<p>当我们在commit时要是真的按照上面这些来执行的话，肯定头都晕了。那么就有插件来帮我们完成了啦啦啦啦。。。。</p>
<p>是的，就是 Commitizen</p>
<h4 id="集成-Commitizen-实现规范提交"><a href="#集成-Commitizen-实现规范提交" class="headerlink" title="集成 Commitizen 实现规范提交"></a>集成 Commitizen 实现规范提交</h4><p>我们使用 Commitizen 工具来帮助我们自动生成 commit message 格式，从而实现规范提交。</p>
<blockquote>
<p>Commitizen 是一个帮助撰写规范 commit message 的工具。它有一个命令行工具 cz-cli。</p>
</blockquote>
<p>安装 Commitizen</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install commitizen -D</span><br></pre></td></tr></table></figure>


<p>成功安装 Commitizen 后，我们用 cz-conventional-changelog 适配器来初始化项目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx commitizen init cz-conventional-changelog --save-dev --save-exact</span><br></pre></td></tr></table></figure>

<p>使用 Commitizen：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 以前我们提交代码都是 git commit -m &quot;xxx&quot;，现在改为 git cz，然后按照终端操作提示，逐步填入信息，就能自动生成规范的 commit message。 --&gt;</span><br><span class="line"></span><br><span class="line">git cz</span><br></pre></td></tr></table></figure>


<p>最后，在 Git 提交历史中就能看到刚刚规范的提交记录了</p>
<h4 id="自定义配置提交说明"><a href="#自定义配置提交说明" class="headerlink" title="自定义配置提交说明"></a>自定义配置提交说明</h4><p>上面这个 git cz 终端操作提示都是英文的，如果想改成中文的或者自定义这些配置选项，我们使用 cz-customizable 适配器。</p>
<p>运行如下命令使用 cz-customizable 初始化项目，注意之前已经初始化过一次，这次再初始化，需要加 –force 覆盖。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx commitizen init cz-customizable --save-dev --save-exact --force</span><br></pre></td></tr></table></figure>

<p>在项目根目录下创建 .cz-config.js 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  // type 类型（定义之后，可通过上下键选择）</span><br><span class="line">  types: [</span><br><span class="line">    &#123; value: &apos;feat&apos;, name: &apos;feat:     新增功能&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;fix&apos;, name: &apos;fix:      修复 bug&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;docs&apos;, name: &apos;docs:     文档变更&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;style&apos;, name: &apos;style:    代码格式（不影响功能，例如空格、分号等格式修正）&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;refactor&apos;, name: &apos;refactor: 代码重构（不包括 bug 修复、功能新增）&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;perf&apos;, name: &apos;perf:     性能优化&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;test&apos;, name: &apos;test:     添加、修改测试用例&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;build&apos;, name: &apos;build:    构建流程、外部依赖变更（如升级 npm 包、修改 webpack 配置等）&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;ci&apos;, name: &apos;ci:       修改 CI 配置、脚本&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;chore&apos;, name: &apos;chore:    对构建过程或辅助工具和库的更改（不影响源文件、测试用例）&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;revert&apos;, name: &apos;revert:   回滚 commit&apos; &#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  // scope 类型（定义之后，可通过上下键选择）</span><br><span class="line">  scopes: [</span><br><span class="line">    [&apos;components&apos;, &apos;组件相关&apos;],</span><br><span class="line">    [&apos;hooks&apos;, &apos;hook 相关&apos;],</span><br><span class="line">    [&apos;utils&apos;, &apos;utils 相关&apos;],</span><br><span class="line">    [&apos;element-ui&apos;, &apos;对 element-ui 的调整&apos;],</span><br><span class="line">    [&apos;styles&apos;, &apos;样式相关&apos;],</span><br><span class="line">    [&apos;deps&apos;, &apos;项目依赖&apos;],</span><br><span class="line">    [&apos;auth&apos;, &apos;对 auth 修改&apos;],</span><br><span class="line">    [&apos;other&apos;, &apos;其他修改&apos;],</span><br><span class="line">    // 如果选择 custom，后面会让你再输入一个自定义的 scope。也可以不设置此项，把后面的 allowCustomScopes 设置为 true</span><br><span class="line">    [&apos;custom&apos;, &apos;以上都不是？我要自定义&apos;]</span><br><span class="line">  ].map(([value, description]) =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      value,</span><br><span class="line">      name: `$&#123;value.padEnd(30)&#125; ($&#123;description&#125;)`</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  // 是否允许自定义填写 scope，在 scope 选择的时候，会有 empty 和 custom 可以选择。</span><br><span class="line">  // allowCustomScopes: true,</span><br><span class="line"></span><br><span class="line">  // allowTicketNumber: false,</span><br><span class="line">  // isTicketNumberRequired: false,</span><br><span class="line">  // ticketNumberPrefix: &apos;TICKET-&apos;,</span><br><span class="line">  // ticketNumberRegExp: &apos;\\d&#123;1,5&#125;&apos;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // 针对每一个 type 去定义对应的 scopes，例如 fix</span><br><span class="line">  /*</span><br><span class="line">  scopeOverrides: &#123;</span><br><span class="line">    fix: [</span><br><span class="line">      &#123; name: &apos;merge&apos; &#125;,</span><br><span class="line">      &#123; name: &apos;style&apos; &#125;,</span><br><span class="line">      &#123; name: &apos;e2eTest&apos; &#125;,</span><br><span class="line">      &#123; name: &apos;unitTest&apos; &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  */</span><br><span class="line"></span><br><span class="line">  // 交互提示信息</span><br><span class="line">  messages: &#123;</span><br><span class="line">    type: &apos;确保本次提交遵循 Angular 规范！\n选择你要提交的类型：&apos;,</span><br><span class="line">    scope: &apos;\n选择一个 scope（可选）：&apos;,</span><br><span class="line">    // 选择 scope: custom 时会出下面的提示</span><br><span class="line">    customScope: &apos;请输入自定义的 scope：&apos;,</span><br><span class="line">    subject: &apos;填写简短精炼的变更描述：\n&apos;,</span><br><span class="line">    body:</span><br><span class="line">      &apos;填写更加详细的变更描述（可选）。使用 &quot;|&quot; 换行：\n&apos;,</span><br><span class="line">    breaking: &apos;列举非兼容性重大的变更（可选）：\n&apos;,</span><br><span class="line">    footer: &apos;列举出所有变更的 ISSUES CLOSED（可选）。 例如: #31, #34：\n&apos;,</span><br><span class="line">    confirmCommit: &apos;确认提交？&apos;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 设置只有 type 选择了 feat 或 fix，才询问 breaking message</span><br><span class="line">  allowBreakingChanges: [&apos;feat&apos;, &apos;fix&apos;],</span><br><span class="line"></span><br><span class="line">  // 跳过要询问的步骤</span><br><span class="line">  // skipQuestions: [&apos;body&apos;, &apos;footer&apos;],</span><br><span class="line"></span><br><span class="line">  // subject 限制长度</span><br><span class="line">  subjectLimit: 100,</span><br><span class="line">  breaklineChar: &apos;|&apos;, // 支持 body 和 footer</span><br><span class="line">  // footerPrefix : &apos;ISSUES CLOSED:&apos;</span><br><span class="line">  // askForBreakingChangeFirst : true,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="集成-commitlint-验证提交规范"><a href="#集成-commitlint-验证提交规范" class="headerlink" title="集成 commitlint 验证提交规范"></a>集成 commitlint 验证提交规范</h4><p>提交代码这个环节，我们也增加一个限制：只让符合 Angular 规范的 commit message 通过</p>
<p>1.安装 commitlint</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @commitlint/config-conventional @commitlint/cli -D</span><br></pre></td></tr></table></figure>

<p>2.配置 commitlint</p>
<p>在项目根目录下创建 commitlint.config.js 文件，并填入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123; extends: [&quot;@commitlint/config-conventional&quot;] &#125;;</span><br></pre></td></tr></table></figure>

<p>3.使用 husky 的 commit-msg hook 触发验证提交信息的命令</p>
<p>我们使用 husky 命令在 .husky 目录下创建 commit-msg 文件，并在此执行 commit message 的验证命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/commit-msg &quot;npx --no-install commitlint --edit $1&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG44.png" alt="cmd-markdown-logo"></p>
<p>最后commitlint 验证，提交信息 test commitlint 符合规范则成功提交到仓库，不符合提示失败</p>
<p>因为已在项目中集成 commitizen，建议大家用 git cz 来代替 git commit 提交代码，可以保证提交信息规范。</p>
<h4 id="如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）"><a href="#如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）" class="headerlink" title="如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）"></a>如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）</h4><p>全局设置 commit-msg 是放在全局目录下的：</p>
<p>创建文件夹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.git_template/hooks</span><br></pre></td></tr></table></figure>

<p>在~/.git_template/hooks文件夹中添加 commit-msg 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> #!/bin/sh</span><br><span class="line"> MSG=`awk &apos;&#123;printf(&quot;%s&quot;,$0)&#125;&apos; $1`</span><br><span class="line"> if [[ $MSG =~ ^(feat|fix|test|refactor|docs|style|chroe)(\(.*\))?:[[:space:]](.+)$</span><br><span class="line">]] then</span><br><span class="line">     echo -e &quot;\033[32m commit success! \033[0m&quot;</span><br><span class="line"> else</span><br><span class="line">     echo -e &quot;\033[31m Error: the commit message is irregular \033[m&quot;</span><br><span class="line">     echo -e &quot;\033[31m Error: type must be one of [feat,fix,docs,style,refactor,tes</span><br><span class="line"> t,chore] \033[m&quot;</span><br><span class="line">     echo -e &quot;\033[31m eg: feat(user): add the user login \033[m&quot;</span><br><span class="line">exit 1 fi</span><br></pre></td></tr></table></figure>

<p>设置全局配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global init.templatedir ~/.git_tempalte</span><br></pre></td></tr></table></figure>

<p>这样全局设置后，创建新的使用git管理的项目的时候自动会将全局的模板拷贝至</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/性能优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/性能优化/" itemprop="url">性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-28T15:09:29+08:00">
                2021-04-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/性能优化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/性能优化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  50
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="性能是什么"><a href="#性能是什么" class="headerlink" title="性能是什么"></a>性能是什么</h3><h3 id="为什么需要性能优化-性能产生的原因"><a href="#为什么需要性能优化-性能产生的原因" class="headerlink" title="为什么需要性能优化/性能产生的原因"></a>为什么需要性能优化/性能产生的原因</h3><h3 id="怎么知道是哪些性能问题影响了"><a href="#怎么知道是哪些性能问题影响了" class="headerlink" title="怎么知道是哪些性能问题影响了"></a>怎么知道是哪些性能问题影响了</h3><pre><code>数据采集： https://juejin.cn/post/6844903998412029959#heading-5</code></pre><h3 id="怎么处理"><a href="#怎么处理" class="headerlink" title="怎么处理"></a>怎么处理</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/大屏注意点/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/大屏注意点/" itemprop="url">大屏注意点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-04-16T14:45:07+08:00">
                2021-04-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/大屏注意点/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/大屏注意点/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  544
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在大屏中往往会碰到这两个问题，那要如何来解决呢？</p>
<ul>
<li>适配屏幕（屏幕大小变化也会监听适配）</li>
<li>多页面和单页面配置问题（vue中其他业务一般为单页面，大屏一般为多页面。那么就需要处理一个项目中既有单页面又有多页面的问题。）</li>
</ul>
<h2 id="适配"><a href="#适配" class="headerlink" title="适配"></a>适配</h2><h3 id="单位上的适配"><a href="#单位上的适配" class="headerlink" title="单位上的适配"></a>单位上的适配</h3><p>要做到适配的话，首先要谈到的就是单位了。</p>
<h4 id="视口（Viewport）比例的长度"><a href="#视口（Viewport）比例的长度" class="headerlink" title="视口（Viewport）比例的长度"></a>视口（Viewport）比例的长度</h4><p>视口百分比定义相对于<a href="https://developer.mozilla.org/en-US/docs/Glossary/Viewport" target="_blank" rel="noopener">Viewport</a>的大小的<length>值，即文档的可见部分。视口长度在<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@page" target="_blank" rel="noopener">@page</a>声明块中无效。</length></p>
<p><code>vh</code>:</p>
<p>视口的初始<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Containing_block" target="_blank" rel="noopener">包含块</a>的高度的1%。</p>
<p><code>vw</code>:</p>
<p>视口的初始<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Containing_block" target="_blank" rel="noopener">包含块</a>的宽度的1%。</p>
<p><code>vi</code>:</p>
<p>等于初始<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Containing_block" target="_blank" rel="noopener">包含块</a>大小的1%,在根元素的<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Logical_Properties#inline-dimension" target="_blank" rel="noopener">行内轴</a>方向上。</p>
<p><code>vb</code>:</p>
<p>等于初始<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Containing_block" target="_blank" rel="noopener">包含块</a>大小的1%,在根元素的<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Logical_Properties#block-dimension" target="_blank" rel="noopener">区块轴</a>方向上。</p>
<p><code>vmin</code>:</p>
<p>视口高度 <code>vw</code> 和宽度 <code>vh</code> 两者之间的最小值。</p>
<p><code>vmax</code>:</p>
<p>视口高度 <code>vw</code> 和宽度 <code>vh</code> 两者之间的最大值。</p>
<h4 id="字体相对单位"><a href="#字体相对单位" class="headerlink" title="字体相对单位"></a>字体相对单位</h4><p>在相对单位中, 尤其是 em 和 rem, 经常被用于满足即使用户更改字体大小，也可以保持页面的垂直阅读节奏可拓展布局中。</p>
<p><code>em</code>:</p>
<p>相对长度单位，这个单位表示元素的<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-size" target="_blank" rel="noopener">font-size</a>的计算值。如果用在font-size 属性本身，它则表示元素继承的 font-size 值。</p>
<p><code>rem</code>:</p>
<p>这个单位代表根元素（通常为&lt;<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/font-size" target="_blank" rel="noopener">html</a>&gt; 元素）的 font-size 大小。当用在根元素的 font-size 上面时 ，它代表了它的初始值。</p>
<p><code>1h</code>:</p>
<p>等于使用它的元素的<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/line-height" target="_blank" rel="noopener">line-height</a>属性的计算值，转换为绝对长度。</p>
<h4 id="绝对长度单位"><a href="#绝对长度单位" class="headerlink" title="绝对长度单位"></a>绝对长度单位</h4><p><code>px</code>:</p>
<p>一像素（pixel）。对于普通的屏幕，通常是一个设备像素（点）。</p>
<p>对于打印机和高分辨率屏幕，一个 CSS 像素往往占多个设备像素。一般来说，每英寸的像素的数量保持在 96 左右， 1px = 1in 的 96 分之一。</p>
<p><code>pt</code>:</p>
<p>一磅（point），72 分之一英寸。1pt = 1/12 * 1pc = 1/72 * 1in。</p>
<h3 id="resize上的适配"><a href="#resize上的适配" class="headerlink" title="resize上的适配"></a>resize上的适配</h3>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/学习篇-语音转识别文字功能的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/学习篇-语音转识别文字功能的实现/" itemprop="url">学习篇-语音识别转文字功能的实现</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-03-26T12:43:07+08:00">
                2021-03-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/学习篇-语音转识别文字功能的实现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/学习篇-语音转识别文字功能的实现/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.6k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>环境： vue-cli 脚手架项目中。</p>
<p>需求：在视频同时实现语音识别转文字需求，类似微信的语音功能（同一个屏幕中，左边布局实现视频功能，另一边布局进行聊天室，聊天室中带了语音识别转文字功能）。点击<code>开启语音识别</code>到<code>关闭语音识别</code>按钮，在这之间说的话会被识别转换为文字的形式并且在聊天框中发送。</p>
<p>流程：前端通过引入iat.js这个包使用到了他的IFlyIatSession方法，后端先提供给前端getVoiceRecogKey接口，前端在这上面获取到了秘钥和uid,前端在将这两个东西传给服务端请求ws，前端在将识别出来的文字渲染在聊天室内。</p>
<p>注： 语音识别转文字功能，在前端上都是自己写的，只是使用了<a href="https://odr-asr.odrcloud.cn/dist/iat.all.final.js" target="_blank" rel="noopener">讯飞的iat包</a>（讯飞的iat包里面只是提供了一个语音转文字的IFlyIatSession方法），其他具体的都是前端自己写的，并且没有文档，前端也不需要去配置啥。</p>
<h2 id="引入包"><a href="#引入包" class="headerlink" title="引入包"></a>引入包</h2><p>在 .html 入口文件中引入这个包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;https://odr-asr.odrcloud.cn/dist/iat.all.final.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="在父组件room-vue调解室中"><a href="#在父组件room-vue调解室中" class="headerlink" title="在父组件room.vue调解室中"></a>在父组件room.vue调解室中</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;inside</span><br><span class="line">        v-show=&quot;insideshow&quot;</span><br><span class="line">        ref=&quot;inside&quot;</span><br><span class="line">        v-model=&quot;comdata&quot;</span><br><span class="line">        :wselement=&quot;ws&quot;</span><br><span class="line">    &gt;&lt;/inside&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import inside from &apos;./inside.vue&apos;  // 语音识别组件</span><br><span class="line">data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">        ws: &apos;&apos;,</span><br><span class="line">        caseStatus: &apos;&apos;,</span><br><span class="line">        currentMessageType: &apos;&apos;, // 当前获取的是公频记录还是私聊记录</span><br><span class="line">    &#125;,</span><br><span class="line">    methods() &#123;</span><br><span class="line">        enterRoom (member) &#123;</span><br><span class="line">            let self = this,</span><br><span class="line">                hostName = config.hostName</span><br><span class="line">            let ws = (this.ws = new WebSocket(  // 在视频内主动连接ws</span><br><span class="line">                &apos;wss://&apos; +</span><br><span class="line">                hostName +</span><br><span class="line">                &apos;/basicGateway/joinRoom/&apos; +</span><br><span class="line">                this.roomID +</span><br><span class="line">                &apos;?JWTToken=&apos; +</span><br><span class="line">                this.userToken +</span><br><span class="line">                &apos;&amp;watcher=&apos; +</span><br><span class="line">                this.iswatcher +</span><br><span class="line">                &apos;&amp;appName=casettle&apos;</span><br><span class="line">            ))</span><br><span class="line">            ws.onopen = function (evt) &#123;</span><br><span class="line">                setInterval(self.heartbeat, 30000)</span><br><span class="line">            &#125;</span><br><span class="line">            ws.onmessage = function (evt) &#123;</span><br><span class="line">                let res = JSON.parse(evt.data)</span><br><span class="line">                self.$refs.inside.uploadMsgList(res.data)  // 获取数据</span><br><span class="line"></span><br><span class="line">                // 媒体开关  监听开关音视频</span><br><span class="line">                this.$refs.inside.speechDiscernControl(res.data, self.isaudioopen) </span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="在-inside-vue-语音识别组件中"><a href="#在-inside-vue-语音识别组件中" class="headerlink" title="在 inside.vue 语音识别组件中"></a>在 <code>inside.vue</code> 语音识别组件中</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;!-- 手动控制语音识别开关 --&gt;</span><br><span class="line">    &lt;div class=&quot;caseStatusBtn&quot;&gt;</span><br><span class="line">        &lt;div :class=&quot;[&#123;on:iflylatStatus&#125;,&apos;voiceBtn&apos;]&quot; @click=&quot;speechSwitch&quot;&gt;&lt;i :class=&quot;[&#123;on:iflylatStatus&#125;,&apos;status&apos;]&quot;&gt;&lt;/i&gt;&#123;&#123;iflylatStatus?&apos;语音识别中&apos;:&apos;开启语音识别&apos;&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;!-- 将识别出来的文字显示在调解室中 --&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li v-for=&quot;msg in msgs&quot; :key=&quot;msg.index&quot; :class=&quot;&#123;&apos;meeting-chatroom-self&apos;: msg.id==comdata.userID&#125;&quot;&gt;</span><br><span class="line">            &lt;div&gt;&#123;&#123;msg.content&#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        import IFlyIatSession from &apos;./iat.js&apos;  // iat.js的代码在下面</span><br><span class="line">        data() &#123;</span><br><span class="line">            return &#123;</span><br><span class="line">                msgs: [],  // ws返回的识别出来的文字</span><br><span class="line">                isOnDesicren: false,</span><br><span class="line">                currentMicStatus: true,</span><br><span class="line">                currentMicStatus: true,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mounted() &#123;</span><br><span class="line">            this.IFlyIatSessionInit()  // 调用IFlyIatSessionInit方法</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            // 初始化语音转写实例</span><br><span class="line">            IFlyIatSessionInit() &#123;</span><br><span class="line">                let _this = this</span><br><span class="line">                let iflysession = &#123;</span><br><span class="line">                    sendMessage: function(result) &#123;</span><br><span class="line">                        _this.sendMessage(result)  // 调用下面的sendMessage方法</span><br><span class="line">                    &#125;,</span><br><span class="line">                    onError: function(code,msg) &#123;</span><br><span class="line">                        _this.iflylatStatus = false</span><br><span class="line">                        _this.$message.error(msg)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                IFlyIatSession.init(iflysession, false)  // 调用到iat.js中的init方法</span><br><span class="line">            &#125;,</span><br><span class="line">            sendMessage (msg) &#123;  // 发送ws请求</span><br><span class="line">                console.log(msg);  // msg 是识别出来的文字</span><br><span class="line">                let self = this,</span><br><span class="line">                    data = &#123;</span><br><span class="line">                        content: msg,</span><br><span class="line">                        messageResource: &apos;VOICE_DISCERN&apos;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    msgdata = &#123;&#125;</span><br><span class="line">                msgdata.event = &apos;SEND_TEXT&apos;</span><br><span class="line">                msgdata.data = data</span><br><span class="line">                self.wselement.send(JSON.stringify(msgdata))</span><br><span class="line">            &#125;,</span><br><span class="line">            // 调解员发出语音识别开关</span><br><span class="line">            speechSwitch () &#123;</span><br><span class="line">                let self = this,</span><br><span class="line">                    msgdata = &#123;&#125;,</span><br><span class="line">                    data = &#123;&#125;,</span><br><span class="line">                data = &#123;</span><br><span class="line">                    mediaType: &apos;VOICE_DISCERN&apos;,</span><br><span class="line">                    memberId: this.comdata.userID,</span><br><span class="line">                    operator: &apos;MEDIATOR&apos;</span><br><span class="line">                &#125;</span><br><span class="line">                msgdata.event = &apos;SWITCH_MEDIA&apos;</span><br><span class="line">                msgdata.data = data</span><br><span class="line">                self.wselement.send(JSON.stringify(msgdata))</span><br><span class="line">            &#125;,</span><br><span class="line">            speechOpen () &#123;  // 打开语音识别</span><br><span class="line">                if(this.currentMicStatus)&#123; // 当前麦克风未被禁用</span><br><span class="line">                    IFlyIatSession.IFlyLatPlay()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            speechColsed () &#123;</span><br><span class="line">                if(this.currentMicStatus)&#123;  // 关闭语音识别</span><br><span class="line">                    IFlyIatSession.IFlyLatStop()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            // 语音识别控制</span><br><span class="line">            speechDiscernControl(data,micStatus) &#123; </span><br><span class="line">                this.currentMicStatus = micStatus</span><br><span class="line">                if(this.iflylatStatus)&#123;</span><br><span class="line">                    this.iflylatStatus = false</span><br><span class="line">                    this.speechColsed()</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    this.iflylatStatus = true</span><br><span class="line">                    this.speechOpen()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            uploadMsgList (message) &#123;  // 是个对象数组，获取所有语音识别的消息，并渲染展示在聊天框中</span><br><span class="line">                this.msgs.push(&#123;content: message.messageContent&#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="iat-js文件"><a href="#iat-js文件" class="headerlink" title="iat.js文件"></a>iat.js文件</h2><p>iat.js文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">import &#123; getVoiceRecogKey &#125; from &apos;./newApi/liu&apos;  //  getVoiceRecogKey是后端给的接口用来获取秘钥和uid</span><br><span class="line">const _IFlyLat = &#123;&#125; // 语音实例</span><br><span class="line">let iflylatSerStatus = false, // 识别服务的状态</span><br><span class="line">    customMethod = null, // 包含回调方法的自定义对象</span><br><span class="line">    isSupport = true, // 浏览器支持的状态</span><br><span class="line">    isTemporary = false, // 兼容通过邀请登录的用户 可调用接口</span><br><span class="line">    IFlyLat = null, // 暂存实例对象</span><br><span class="line">    restart = false, // 重新获取密钥后是否开启识别</span><br><span class="line">    voiceToken = &apos;&apos;,</span><br><span class="line">    voiceUid = &apos;&apos;,</span><br><span class="line">    isSuccess = true, // 获取语音识别密钥接口是否返回数据</span><br><span class="line">    isRestart = false, // 是否重新建立语音识别链接</span><br><span class="line">    iatData = &#123;&#125;;</span><br><span class="line">function getVoiceTonken() &#123;</span><br><span class="line">    isSuccess = false</span><br><span class="line">    getVoiceRecogKey(&#123;&#125;,isTemporary).then(res =&gt; &#123;</span><br><span class="line">        if(res.key) &#123;</span><br><span class="line">            voiceToken = res.key</span><br><span class="line">            voiceUid = res.uid</span><br><span class="line">            if(isRestart) &#123;</span><br><span class="line">                speedService()  // 调用iat.js中speedService方法</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        isSuccess = true</span><br><span class="line">    &#125;).catch((e)=&gt; &#123;</span><br><span class="line">        isSuccess = true</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">function speedService() &#123; // 建立语音转文字初始化</span><br><span class="line">    if(process.env.srconfig === &quot;prod&quot;) &#123;  // 不同环境参数、域名不同</span><br><span class="line">        iatData = &#123;</span><br><span class="line">            &quot;uid&quot;: voiceUid,</span><br><span class="line">            &quot;token&quot;: voiceToken</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        iatData = &#123;</span><br><span class="line">            &quot;serverUrl&quot;: &quot;wss://odr-asr.odrcloud.cn/ws2&quot;,</span><br><span class="line">            &quot;uid&quot;: voiceUid,</span><br><span class="line">            &quot;token&quot;: voiceToken</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // IFlyIatSession方法是iat.js提供的</span><br><span class="line">    IFlyLat = new IFlyIatSession(&#123;  </span><br><span class="line">        &quot;params&quot;: iatData,</span><br><span class="line">        &quot;callback&quot;: &#123;</span><br><span class="line">            &quot;onResult&quot;: function(result) &#123;</span><br><span class="line">                if (result == &apos;&apos; || result == null) &#123;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    // 传入回调方法名为sendMessage</span><br><span class="line">                    console.log(&apos;999999999999999&apos;,result); // result就是识别出来的文字</span><br><span class="line">                    customMethod.sendMessage(result)  // 调用的是IFlyIatSessionInit中的sendMessage方法</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;onVolume&quot;: function(volume) &#123;</span><br><span class="line">                // 音量</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;onError&quot;: function(code,msg) &#123;</span><br><span class="line">                customMethod.onError(code,msg)</span><br><span class="line">                console.log(&quot;错误&quot;,code,msg)</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;onProcess&quot;: function(status) &#123;</span><br><span class="line">                switch (status) &#123;</span><br><span class="line">                    case &apos;onStart&apos;:</span><br><span class="line">                        iflylatSerStatus = true;</span><br><span class="line">                        console.log(&quot;服务初始化。。。&quot;)</span><br><span class="line">                        break;</span><br><span class="line">                    case &apos;normalVolume&apos;:</span><br><span class="line">                    case &apos;started&apos;:</span><br><span class="line">                        console.log(&quot;倾听中。。。&quot;)</span><br><span class="line">                        break;</span><br><span class="line">                    case &apos;onStop&apos;:</span><br><span class="line">                        console.log(&quot;等待结果。。。&quot;)</span><br><span class="line">                        break;</span><br><span class="line">                    case &apos;lowVolume&apos;:</span><br><span class="line">                        console.log(&quot;倾听中。。。（声音过小）&quot;)</span><br><span class="line">                        break;</span><br><span class="line">                    default:</span><br><span class="line">                        console.log(&quot;结束&quot;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    if (!IFlyLat.isSupport()) &#123;</span><br><span class="line">        Vue.prototype.$alert(&apos;当前浏览器不支持语音转文字&apos;, &apos;温馨提示&apos;, &#123;</span><br><span class="line">            confirmButtonText: &apos;确定&apos;,</span><br><span class="line">            confirmButtonClass: &apos;button_primary&apos;,</span><br><span class="line">            showClose:false,</span><br><span class="line">            customClass: &apos;meetbox&apos;,</span><br><span class="line">            callback: action =&gt; &#123;</span><br><span class="line">                history.back()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        isSupport = false</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    if(restart) &#123;</span><br><span class="line">        IFlyLat.start()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">_IFlyLat.init =  function(custom,temporary) &#123; // 初始实例化</span><br><span class="line">    if(temporary) &#123;</span><br><span class="line">        isTemporary = true</span><br><span class="line">    &#125;</span><br><span class="line">    if (custom) &#123;</span><br><span class="line">        customMethod = custom</span><br><span class="line">    &#125;</span><br><span class="line">    if(voiceToken&amp;&amp;voiceUid) &#123;</span><br><span class="line">        isRestart = false</span><br><span class="line">        speedService()</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        isRestart = true</span><br><span class="line">        if(isSuccess) &#123;</span><br><span class="line">            getVoiceTonken()  // 调用iat.js中getVoiceTonken方法</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">_IFlyLat.IFlyLatPlay =  function() &#123; // 开始识别</span><br><span class="line">    if(isSupport) &#123;</span><br><span class="line">        if(IFlyLat) &#123;</span><br><span class="line">            IFlyLat.start()</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            restart = true</span><br><span class="line">            this.init()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">_IFlyLat.IFlyLatStop = function() &#123; // 停止识别</span><br><span class="line">    IFlyLat.pause()</span><br><span class="line">&#125;</span><br><span class="line">_IFlyLat.IFlyLatKill = function() &#123; // 销毁退出</span><br><span class="line">    if(IFlyLat) &#123;</span><br><span class="line">        // IFlyLat.pause()</span><br><span class="line">        IFlyLat.kill()</span><br><span class="line">        IFlyLat = null</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default _IFlyLat</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/前端方面性能优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/前端方面性能优化/" itemprop="url">前端方面性能优化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-24T16:47:57+08:00">
                2021-02-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/前端方面性能优化/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/前端方面性能优化/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  263
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="首屏懒加载：在鼠标滑动时加载相应内容"><a href="#首屏懒加载：在鼠标滑动时加载相应内容" class="headerlink" title="首屏懒加载：在鼠标滑动时加载相应内容"></a>首屏懒加载：在鼠标滑动时加载相应内容</h2><h2 id="vue-router路由懒加载：在进入相应的页面时才加载相应的页面模块"><a href="#vue-router路由懒加载：在进入相应的页面时才加载相应的页面模块" class="headerlink" title="vue-router路由懒加载：在进入相应的页面时才加载相应的页面模块"></a>vue-router路由懒加载：在进入相应的页面时才加载相应的页面模块</h2><p>当访问到当前页面才会加载相关的资源。当点击对应路由时才加载对应的页面，而不是一开始就将路由文件中的所以页面都加载出来。通过import方法实现路由懒加载或者vue异步组件实现。</p>
<p>在router.js中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        path: &apos;/upload&apos;,</span><br><span class="line">        name: upload,</span><br><span class="line"></span><br><span class="line">        // 方法一：import方式实现</span><br><span class="line">        component: () =&gt; import(&apos;upload页面路径&apos;)  // 通过import方法实现路由懒加载</span><br><span class="line"></span><br><span class="line">        // 方法二：vue异步组件实现</span><br><span class="line">        component: resolve =&gt; (require([&apos;@/upload页面路径&apos;], resolve))</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="组件懒加载"><a href="#组件懒加载" class="headerlink" title="组件懒加载"></a>组件懒加载</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;hello&quot;&gt;</span><br><span class="line">    &lt;hello-world&gt;&lt;/hello-world&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    export default &#123;</span><br><span class="line">        components: &#123;</span><br><span class="line"></span><br><span class="line">            // 方法一：import方式实现</span><br><span class="line">            &apos;HelloWorld&apos;: () =&gt; import(&apos;./HelloWorld&apos;),</span><br><span class="line"></span><br><span class="line">            // 方法二：vue异步组件实现</span><br><span class="line">            &apos;HelloWorld&apos;: resolve =&gt; ([&apos;./HelloWorld&apos;], resolve)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/ES6-重读/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/ES6-重读/" itemprop="url">ES6 重读</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-02-01T17:05:04+08:00">
                2021-02-01
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/ES6-重读/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/ES6-重读/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4.9k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="let"><a href="#let" class="headerlink" title="let"></a>let</h2><p>let 是 ES6 中新增的，它和 ES5 中的 var 的区别如下：</p>
<ul>
<li><p>不属于顶层对象window，属于script下的，在node中是global</p>
</li>
<li><p>不允许重复声明</p>
</li>
<li><p>不存在<code>变量提升</code>(先声明再使用)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let a = 0</span><br><span class="line">console.log(a)  // 这样就是先声明再使用</span><br><span class="line"></span><br><span class="line">console.log(a)  // a is not defined，这样先使用再声明就是变量提升了会报错</span><br><span class="line">let a = 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>暂时性死区（在封闭的作用域中，先使用再声明）</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function foo(a=b,b=2) &#123;</span><br><span class="line">    console.log(a)</span><br><span class="line">&#125;</span><br><span class="line">foo()  // 这样也会造成暂时性死区，因为a=b时，b还没有赋值，相当于先使用再声明</span><br></pre></td></tr></table></figure>
</li>
<li><p>块级作用域</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for( let i = 0; i &lt; 3; i++ ) &#123;</span><br><span class="line">    console.log(i)  // 0,1,2  i只能在这个作用域中访问</span><br><span class="line">&#125;</span><br><span class="line">console.log(i)  // 会报错。 因为使用了let 在循环作用域结束后i就被销毁了</span><br></pre></td></tr></table></figure>

<blockquote>
<p>es5中没有块级作用域，只有<code>全局作用域</code>和<code>函数作用域</code></p>
</blockquote>
</li>
</ul>
<p>面试题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for(var i = 0; i &lt; 3; i ++) &#123;</span><br><span class="line">    setTimeout(function()&#123;</span><br><span class="line">        console.log(i)  // 3,3,3</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为setTimeout是一个异步操作，而for是同步操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for(var i = 0; i &lt; 3; i ++) &#123;</span><br><span class="line">    (function(i)&#123;</span><br><span class="line">        setTimeout(function()&#123;</span><br><span class="line">            console.log(i)  // 0,1,2</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为立即执行函数（闭包）接收i的参数，并且又是立即执行函数。</p>
<h2 id="const"><a href="#const" class="headerlink" title="const"></a>const</h2><p>const 是 ES6 中新增的一个常量。</p>
<p>在ES5中的实现方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Object.defineProperty(window,&apos;PI&apos;,&#123;</span><br><span class="line">    value: 3.14,</span><br><span class="line">    writable: false</span><br><span class="line">&#125;)</span><br><span class="line">PI = 6</span><br><span class="line">console.log(PI) // 不能被改变  还是3.14</span><br></pre></td></tr></table></figure>

<p>const 不能改变指的是：内存地址不改动。对于栈内存来说基本类型下保存的是值，引用类型保存的是引用地址(不变的是这个)，但实际引用地址中的值在堆内存中这个是可以变的。如下图：</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/ES6%E9%87%8D%E8%AF%BB/WechatIMG1.png" alt="cmd-markdown-logo"></p>
<p>如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const obj = &#123;</span><br><span class="line">    name: &apos;lzzhy&apos;,</span><br><span class="line">    age: 18</span><br><span class="line">&#125;</span><br><span class="line">obj.sex = &apos;male&apos;</span><br><span class="line">console.log(obj)  // &#123;name: &apos;lzzhy&apos;,age: 18,sex: &apos;male&apos;&#125;</span><br></pre></td></tr></table></figure>

<p>特性（跟let一样）：</p>
<ul>
<li>不属于顶层对象window</li>
<li>不允许重复声明</li>
<li>不存在<code>变量提升</code>(先声明再使用)</li>
<li>暂时性死区（在封闭的作用域中，先使用再声明）</li>
<li>块级作用域</li>
</ul>
<h2 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h2><ul>
<li><p>按照<code>一定模式</code>(解构赋值：简单来说就是‘=’两边的<code>模式结构匹配</code>)，从数组和变量之类的之中提取值，对变量进行赋值</p>
</li>
<li><p>数组解构</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let [a,b,[c,d]] = [1,2,[3,4]]  //  &apos;=&apos;两边结构是一样的</span><br></pre></td></tr></table></figure>
</li>
<li><p>对象解构</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let girl = &#123;</span><br><span class="line">    name: &apos;lzzhy&apos;,</span><br><span class="line">    age: 18</span><br><span class="line">&#125;</span><br><span class="line">let &#123;name: uname, age: uage&#125; = girl  // 别名在‘:’后面那个</span><br><span class="line">const (uname, uage)  // 这样获取的意思&apos;lzzhy&apos;,18</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串解构</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let arr = &apos;lzzhy&apos;</span><br><span class="line">let [a,b,c,d,e] = arr</span><br><span class="line">console.log(a,b,c,d,e)  // l z z h y</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>应用</p>
<p>传参时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function foo(&#123;name,age,sex = &apos;male&apos;&#125;) &#123;</span><br><span class="line">    console.log(name,age,sex)  </span><br><span class="line">&#125;</span><br><span class="line">let obj = &#123;</span><br><span class="line">    name: &apos;lzzhy&apos;,</span><br><span class="line">    age: 18</span><br><span class="line">&#125;</span><br><span class="line">foo(obj)  //lzzhy,18,male</span><br></pre></td></tr></table></figure>

<p>取值时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function foo()&#123;</span><br><span class="line">let obj = &#123;</span><br><span class="line">        name: &apos;lzzhy&apos;,</span><br><span class="line">        age: 18</span><br><span class="line">    &#125; </span><br><span class="line">    return obj</span><br><span class="line">&#125;</span><br><span class="line">let &#123;name, age: uage&#125; = obj  // lzzhy,18</span><br></pre></td></tr></table></figure>

<p>获取json串时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let ujson = &apos;&#123;&quot;a&quot;: &quot;lzzhy&quot;,&quot;b&quot;: &quot;dance&quot;&#125;&apos;</span><br><span class="line">let &#123;a,b&#125; = JSON.parse(ujson)</span><br><span class="line">console.log(a,b)  // lzzhy,dance</span><br></pre></td></tr></table></figure>

<h2 id="数组遍历"><a href="#数组遍历" class="headerlink" title="数组遍历"></a>数组遍历</h2><p>reduce实现数组去重：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let arr = [1,2,3,4,3]</span><br><span class="line">let res = arr.reduce(function(prev,cur) &#123;</span><br><span class="line">    prev.indexOf(cur) == -1 &amp;&amp; prev.push(cur)</span><br><span class="line">    return prev</span><br><span class="line">&#125;,[])</span><br><span class="line">console.log(res)</span><br></pre></td></tr></table></figure>

<p>类数组/伪数组：不是真正意义上的数组。具有length,但是不具有数组的方法</p>
<p>类数组/伪数组转化为真正的数组：</p>
<p>ES5：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array.prototype.slice.call(伪数组)  // 转换成真正的数组</span><br></pre></td></tr></table></figure>

<p>ES6：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array.from(伪数组)</span><br></pre></td></tr></table></figure>

<h2 id="函数的参数"><a href="#函数的参数" class="headerlink" title="函数的参数"></a>函数的参数</h2><ul>
<li><p>参数的默认值</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function foo(x,y=&apos;world&apos;) &#123;</span><br><span class="line">    console.log(x,y)</span><br><span class="line">&#125;</span><br><span class="line">foo(&apos;hello&apos;, 0)  // hello,0</span><br><span class="line">foo(&apos;hello&apos;)  // hello,world</span><br></pre></td></tr></table></figure>
</li>
<li><p>与解构赋值结合</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function ajax(url,&#123;</span><br><span class="line">    body= &apos;&apos;,</span><br><span class="line">    method=&apos;GET&apos;,</span><br><span class="line">    headers=&#123;&#125;</span><br><span class="line">&#125; = &#123;&#125;) &#123;</span><br><span class="line">    console.log(method)</span><br><span class="line">&#125;</span><br><span class="line">ajax(&apos;baidu.com&apos;)  //  GET</span><br><span class="line">ajax(&apos;baidu.com&apos;,&#123;method=&apos;POST&apos;&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>length属性(可以获取没有默认值的参数的个数)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function foo(x,y,z=1) &#123;</span><br><span class="line">    console.log(x,y)</span><br><span class="line">&#125;</span><br><span class="line">console.log(foo.length)  // z没有默认值length值为3，有就为2</span><br></pre></td></tr></table></figure>
</li>
<li><p>作用域</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let x =1</span><br><span class="line">function foo(y = x)&#123;</span><br><span class="line">    let x =2;  // 重复定义不报错，因为不在同一个作用域</span><br><span class="line">    console.log(y)</span><br><span class="line">&#125;</span><br><span class="line">foo()  // 1</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="扩展运算符和res参数"><a href="#扩展运算符和res参数" class="headerlink" title="扩展运算符和res参数"></a>扩展运算符和res参数</h2><p>扩展运算符 …：把数组或者类数组之类的展开成用逗号隔开的值（在等号的右边或者实参上）。</p>
<pre><code>let arr1 = [1,2,3]
let arr2 = [8,9,7]
let a = [...arr1, ...arr2]  // [1, 2, 3, 8, 9, 7] 数组合并</code></pre><p>res参数：把逗号隔开的值组合成一个数组（在等号的左边或者形参上）。</p>
<pre><code>function foo(x, ...args) {
    console.log(x)  // 1
    console.log(args)  // [2, 3, 4, 5]
}
foo(1,2,3,4,5)</code></pre><p>形参：是封装好的函数的参数；实参：是调用该函数时传的参数；</p>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><ul>
<li><p>this指向定义时所在的对象，而不是调用时所在的对象(箭头函数本身其实并不存在this，只是用了在外一层的this)</p>
</li>
<li><p>不可以当做构造函数(因为受eval影响)</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let People = (name, age) =&gt; &#123;</span><br><span class="line">    this.name = name </span><br><span class="line">    this.age = age</span><br><span class="line">&#125;</span><br><span class="line">let p1 = new People(&apos;lzzhy&apos;,18)  // People is not a constructor</span><br></pre></td></tr></table></figure>
</li>
<li><p>不可以使用arguments对象(因为受eval影响)</p>
</li>
</ul>
<h2 id="对象的扩展"><a href="#对象的扩展" class="headerlink" title="对象的扩展"></a>对象的扩展</h2><ul>
<li><p>Object.is()：类似===</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object.is(NaN,NaN)  // true</span><br></pre></td></tr></table></figure>
</li>
<li><p>扩展运算符与Object.assign()（合并对象）</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let x =&#123;</span><br><span class="line">    a: 3,</span><br><span class="line">    b:5</span><br><span class="line">&#125;</span><br><span class="line">let y = &#123;b:6&#125;</span><br><span class="line">Object.assign(x,y)  // &#123;a: 3, b: 6&#125;  有相同的值的话会被后面的对象覆盖</span><br></pre></td></tr></table></figure>
</li>
<li><p>对象的遍历方式</p>
<p>  初始代码：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123;</span><br><span class="line">    name: &apos;lzzhy&apos;,</span><br><span class="line">    age: 18,</span><br><span class="line">    sex: &apos;male&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  Object.keys：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object.keys(obj).forEach(key =&gt; &#123;</span><br><span class="line">    console.log(key,obj[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>  Object.getOwnPropertyNames：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object.getOwnPropertyNames(obj).forEach(key =&gt; &#123;</span><br><span class="line">    console.log(key,obj[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>  Reflect.ownKeys：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Reflect.ownKeys(obj).forEach(key =&gt; &#123;</span><br><span class="line">    console.log(key,obj[key])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="类与继承"><a href="#类与继承" class="headerlink" title="类与继承"></a>类与继承</h2><p>实例属性，静态属性以及静态方法的区别：</p>
<p>es5中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function People(name, age) &#123;</span><br><span class="line">    &lt;!--names和ages是实例属性：和实例化对象有关的 --&gt;</span><br><span class="line">    this.names = name</span><br><span class="line">    this.ages = age</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 静态属性：跟实例化对象无关的属性 --&gt;</span><br><span class="line">People.count = 0</span><br><span class="line">console.log(People.count)</span><br><span class="line"></span><br><span class="line">&lt;!-- 静态方法：跟实例化方法无关 --&gt;</span><br><span class="line">Math.max()</span><br><span class="line"></span><br><span class="line">&lt;!-- 实例方法：和实例原型上的方法 --&gt;</span><br><span class="line">People.prototype.shouName = function() &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>es6是通过static在类中实现静态方法的。</p>
<h2 id="Set-一种新的数据结构"><a href="#Set-一种新的数据结构" class="headerlink" title="Set 一种新的数据结构"></a>Set 一种新的数据结构</h2><p>Set：一种新的数据结构，类似于数组，也可用于遍历。</p>
<ul>
<li><p>常见应用场景</p>
<p>  数组去重：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let s = new Set([1,2,3,4,1,3])  // Set(4) &#123;1, 2, 3, 4&#125;</span><br></pre></td></tr></table></figure>

<p>  数组合并去重（交集）：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let arr1 = [1,2,3,4,5]</span><br><span class="line">let arr2 = [1,3,6,5,8] </span><br><span class="line">let arr3 = new Set([...arr1, ...arr2]</span><br><span class="line">console.log(Array.from(arr3))  // [1, 2, 3, 4, 5, 6, 8]</span><br></pre></td></tr></table></figure>

<p>  筛选数组差集：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr1 = [1,2,3,4]</span><br><span class="line">let arr2 = [2,3,4,5,6,7]</span><br><span class="line">let s1 = new Set(arr1)</span><br><span class="line">let s2 = new Set(arr2)</span><br><span class="line">let arr3 = new Set(arr1.filter(item =&gt; !s2.has(item)))  // Set(1) &#123;1&#125; </span><br><span class="line">let arr4 = new Set(arr2.filter(item =&gt; !s1.has(item)))  // Set(3) &#123;5, 6, 7&#125;</span><br><span class="line"></span><br><span class="line">[...arr3, ...arr4]  // [1,5,6,7]</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Proxy代理"><a href="#Proxy代理" class="headerlink" title="Proxy代理"></a>Proxy代理</h2><ul>
<li>代理：对于当前的一些对象或者方法或者其他操作先代理过来，在用相对应的拦截方法去处理各种各样的操作。</li>
<li>常用拦截方法</li>
</ul>
<p>ES5 中可以通过 Object.definePropert 对对象的属性进行拦截；其中第一个参数是拦截对象本身，第二个参数是对于哪个属性进行拦截，第三个参数可以是对应的方法。如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123;&#125;</span><br><span class="line">let newVal = &apos;&apos;</span><br><span class="line">Object.defineProperty(obj, &apos;name&apos;, &#123;  // Object.definePropert 是ES5中的拦截的api。分别对应的三个参数</span><br><span class="line">    get() &#123;</span><br><span class="line">        console.log(&apos;get&apos;)</span><br><span class="line">        return newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    set(val) &#123;</span><br><span class="line">        console.log(&apos;set&apos;)</span><br><span class="line">        newVal = val</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(obj.name)  // get</span><br><span class="line"></span><br><span class="line">obj.name = &apos;es&apos;  // 会调用set方法</span><br><span class="line">console.log(obj.name)  // es</span><br></pre></td></tr></table></figure>

<p>ES6 通过 Proxy（第一个参数是：需要拦截的对象或者是方法，第二个参数是代理的钩子函数）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let obj = &#123;&#125;</span><br><span class="line">let p = new Proxy(obj, &#123;&#125;)</span><br><span class="line">p.name = &apos;lzzhy&apos;</span><br><span class="line">console.log(obj.name)  // lzzhy</span><br></pre></td></tr></table></figure>

<p>Proxy 常用的拦截方法：</p>
<p>get（拦截对象属性的 读 操作）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let arr = [7,8,9]</span><br><span class="line">arr = new Proxy(arr, &#123;</span><br><span class="line">    get(target, prop) &#123; // get钩子函数对应的两个参数：代理的对象，参数值</span><br><span class="line">        console.log(target, prop)</span><br><span class="line">        return prop in target ? target[prop] : &apos;error&apos;  // 判断是否在里面，在的话返回下标对应的值</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(arr[2])  // 9</span><br></pre></td></tr></table></figure>

<p>set（拦截对象属性的设置）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let arr = []</span><br><span class="line">arr = new Proxy(arr, &#123;</span><br><span class="line">    set(target, prop, val) &#123;  // set钩子函数对应的三个参数：目标对象、目标属性的值、需设置的值</span><br><span class="line">        if(typeof val === &apos;number&apos;) &#123;</span><br><span class="line">            target[prop] = val</span><br><span class="line">            return true</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">arr.push(9)</span><br><span class="line">console.log(arr[0])  // 9</span><br></pre></td></tr></table></figure>

<p>has（拦截proxyKey in proxy的操作）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let range = &#123;</span><br><span class="line">    start: 1,</span><br><span class="line">    end: 5</span><br><span class="line">&#125;</span><br><span class="line">range = new Proxy(range, &#123;</span><br><span class="line">    has(target, prop) &#123;</span><br><span class="line">        return prop &lt;= target.start &amp;&amp; prop &lt;= target.end</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(1 in range)  // true</span><br><span class="line">console.log(9 in range)  // false</span><br></pre></td></tr></table></figure>

<p>ownKeys（用于对象循环遍历进行拦截）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let userinfo = &#123;</span><br><span class="line">    username: &apos;lzzhy&apos;,</span><br><span class="line">    age: 18,</span><br><span class="line">    _password: &apos;***&apos;</span><br><span class="line">&#125;</span><br><span class="line">userinfo = new Proxy(userinfo, &#123;</span><br><span class="line">    ownKeys(target) &#123;</span><br><span class="line">        return Object.keys(target).filter(key =&gt; !key.startsWith(&apos;_&apos;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">for(let key in userinfo) &#123;</span><br><span class="line">    console.log(key)  // username,age</span><br><span class="line">&#125;</span><br><span class="line">console.log(Object.keys(userinfo))  // [&quot;username&quot;, &quot;age&quot;]</span><br></pre></td></tr></table></figure>

<p>apply（用于拦截函数调用以及apply,call的操作）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let sum = (...args) =&gt; &#123;</span><br><span class="line">    let num = 0</span><br><span class="line">    args.forEach(item =&gt; &#123;</span><br><span class="line">        num += item</span><br><span class="line">    &#125;)</span><br><span class="line">    return num </span><br><span class="line">&#125;</span><br><span class="line">sum = new Proxy(sum, &#123;</span><br><span class="line">    apply(target, ctx, args) &#123;  // apply对应的三个参数：拦截的目标，当前上下文，目标对象参数数组</span><br><span class="line">        return target(...args) * 2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">console.log(sum(8,2))  // 20</span><br><span class="line">console.log(sum.call(null,1,2,3))  // 12</span><br><span class="line">console.log(sum.apply(null,[1,2,3]))  // 12</span><br></pre></td></tr></table></figure>

<p>construct（用于拦截new命令，返回一个对象）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let User = class &#123;</span><br><span class="line">    constructor(name) &#123;</span><br><span class="line">        this.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">User = new Proxy(User, &#123;</span><br><span class="line">    construct(target, args, newTarget) &#123;  // 三个参数：目标对象，构造函数的参数列表，new作用的函数</span><br><span class="line">        return new target(...args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(new User(&apos;lzzhy&apos;))  // User &#123;name: &quot;lzzhy&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Reflect-反射"><a href="#Reflect-反射" class="headerlink" title="Reflect 反射"></a>Reflect 反射</h2><ul>
<li><p>将Object属于语言内部的方法放到Reflect上</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 这段代码是es5中实现代理的方法，由于现在Reflect会将Object属于语言内部的方法放到Reflect上，因此可以直接将Object换成Reflect  --&gt;</span><br><span class="line"></span><br><span class="line">let obj = &#123;&#125;</span><br><span class="line">let newVal = &apos;&apos;</span><br><span class="line">Reflect.defineProperty(obj, &apos;name&apos;, &#123;  // 直接将Object换成Reflect </span><br><span class="line">    get() &#123;</span><br><span class="line">        console.log(&apos;get&apos;)</span><br><span class="line">        return newVal</span><br><span class="line">    &#125;,</span><br><span class="line">    set(val) &#123;</span><br><span class="line">        console.log(&apos;set&apos;)</span><br><span class="line">        newVal = val</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">console.log(obj.name)  // get</span><br><span class="line"></span><br><span class="line">obj.name = &apos;es&apos;  // 会调用set方法</span><br><span class="line">console.log(obj.name)  // es</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改某些Object方法的返回结果，让其变得合理</p>
</li>
<li><p>让Object操作变成函数行为</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Object的写法 --&gt;</span><br><span class="line">console.log(&apos;assign&apos; in Object)  // true</span><br><span class="line"></span><br><span class="line">&lt;!-- Reflect的写法 --&gt;</span><br><span class="line">console.log(Reflect.has(Object, &apos;assign&apos;))</span><br></pre></td></tr></table></figure>
</li>
<li><p>Reflect对象的方法与Proxy对象的方法一一对应（Proxy拦截器的名称是啥改成对应的Reflect.拦截器名称就行）。如：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let arr = []</span><br><span class="line">arr = new Proxy(arr, &#123;</span><br><span class="line">    set(target, prop, val) &#123;</span><br><span class="line">        if(typeof val === &apos;number&apos;) &#123;</span><br><span class="line">            &lt;!-- Proxy的写法</span><br><span class="line"></span><br><span class="line">            target[prop] = val --&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- Reflect的写法</span><br><span class="line"></span><br><span class="line">            Reflect.set(target,prop,val) --&gt;</span><br><span class="line"></span><br><span class="line">            return true</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">arr.push(9)</span><br><span class="line">console.log(arr[0])  // 9</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="异步操作前置知识"><a href="#异步操作前置知识" class="headerlink" title="异步操作前置知识"></a>异步操作前置知识</h2><p>异步操作前置知识：</p>
<ul>
<li><p>JS是单线程的：同一个时间内只能处理一个任务。</p>
</li>
<li><p>同步任务与异步任务</p>
<p>  <img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/ES6%E9%87%8D%E8%AF%BB/WechatIMG2.png" alt="cmd-markdown-logo"></p>
<p>  这张图展示了JS单线程的执行过程：JS会从上往下执行，当碰到同步任务时会立即执行，碰到异步任务时会先将该异步操作存放在任务队列中（如：即使setTimeout中为0时也算异步），在往下继续执行同步任务。当主线程上的同步任务都结束后，才会去读取任务队列中的异步操作。</p>
<p>  如下的同步任务和异步任务：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">console.log(1)</span><br><span class="line">setTimeout(() =&gt; &#123;</span><br><span class="line">    console.log(2)  </span><br><span class="line">&#125;, 0)  // 在JS底层中最短时间是4ms,因此这里写0并不是真的代表0ms</span><br><span class="line">console.log(3)  // 1,3,2</span><br><span class="line"></span><br><span class="line">&lt;!-- 在setTimeout或其他异步中，后面的时间（假设写的是2000）也不一定就是2000之后就执行了。根据上面这张图setTimeout异步任务会在2000之后进入 Event Queue 任务队列中。而setTimeout异步操作是否执行还需要取决于主线程中同步任务是否结束并且异步操作时间达到这个2000已经在任务队列中等待 --&gt;</span><br></pre></td></tr></table></figure>

<p>  以上执行结果为 1 3 2。因为在console.log 1,2,3中，JS会按照上下文先后顺序执行，但是由于setTimeout表示异步，因此会先执行完同步主线程上的操作也就是console.log 1,3，当同步任务主线程完成后才会执行异步队列中的操作</p>
</li>
<li><p>Ajax（叫做异步的javascript的XML）原理：</p>
</li>
</ul>
<p>ajax和axios的区别：两者其实没有太大的区别，在写法上大致相同；ajax是通过jQuery来封装的；axios是通过promise实现对ajax技术的一种封装。（也就是说：jQuery将请求技术进行封装变成了ajax，而通过promise又把ajax进行封装变成axios）</p>
<pre><code>原生的原理：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 1.创建XMLHttpRequest对象 --&gt;</span><br><span class="line">var url = &apos;接口地址&apos;</span><br><span class="line">var xmlhttp</span><br><span class="line">if(window.XMLHttpRequest) &#123;  // 兼容问题 ie7之后的版本</span><br><span class="line">    xmlhttp = new XMLHttpRequest()</span><br><span class="line">&#125; else &#123;  // 兼容早期浏览器</span><br><span class="line">    xmlhttp = new ActiveXOBject(&apos;Microsoft XMLHTTP&apos;)</span><br><span class="line">&#125;</span><br><span class="line">&lt;!-- 2.发送请求 --&gt;</span><br><span class="line">xmlhttp.open(&apos;GET&apos;, url, true)</span><br><span class="line">xmlhttp.send()</span><br><span class="line">&lt;!-- 3.接收服务端响应 --&gt;</span><br><span class="line">xmlhttp.onreadystatechange = function()&#123;</span><br><span class="line">    if(xmlhttp.readState === 4 &amp;&amp; xmlhttp.status === 4) &#123;</span><br><span class="line">        var obj = JSON.parse(xmlhttp.responseText)</span><br><span class="line">        console.log(obj)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

封装后的Ajax：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">function ajax(url, successCallback, failCallback) &#123;</span><br><span class="line">    var xmlhttp</span><br><span class="line">    if(window.XMLHttpRequest) &#123;</span><br><span class="line">        xmlhttp = new XMLHttpRequest()</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        xmlhttp = new ActiveXOBject(&apos;Microsoft XMLHTTP&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">    &lt;!-- 2.发送请求 --&gt;</span><br><span class="line">    xmlhttp.open(&apos;GET&apos;, url, true)</span><br><span class="line">    xmlhttp.send()</span><br><span class="line">    &lt;!-- 3.接收服务端响应 --&gt;</span><br><span class="line">    xmlhttp.onreadystatechange = function()&#123;</span><br><span class="line">        if(xmlhttp.readState === 4 &amp;&amp; xmlhttp.status === 404) &#123;</span><br><span class="line">            var obj = JSON.parse(xmlhttp.responseText)</span><br><span class="line">            console.log(obj)</span><br><span class="line">            successCallback &amp;&amp; successCallback(obj)</span><br><span class="line">        &#125; else if(xmlhttp.readState === 4 &amp;&amp; xmlhttp.status !== 404) &#123;</span><br><span class="line">            failCallback &amp;&amp; failCallback(xmlhttp.statueText)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var url = &quot;接口地址&quot;</span><br><span class="line">ajax(url, res =&gt; &#123;</span><br><span class="line">    console.log(res)</span><br><span class="line">&#125;, err =&gt; &#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></code></pre><ul>
<li><p>Callback Hell(回调深渊/回调地狱)</p>
<p>  多个异步操作层层嵌套：如 有1，2，3 三个接口，需要执行完1后在执行2在执行3（或者如 省市县选择）：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 在各个回调函数中执行就行了 --&gt;</span><br><span class="line"></span><br><span class="line">ajax(url, res =&gt; &#123;  // 接口1</span><br><span class="line">    ajax(url, res =&gt; &#123;  // 接口2</span><br><span class="line">        ajax(url, res =&gt; &#123;  // 接口3</span><br><span class="line">        </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>  这种写法虽然可以实现需求，可是代码可读性和维护性不行。可以通过Promise来解决，如下一节通过Promise实现省市区。</p>
</li>
</ul>
<h2 id="异步编程解决方案一：-Promise"><a href="#异步编程解决方案一：-Promise" class="headerlink" title="异步编程解决方案一： Promise"></a>异步编程解决方案一： Promise</h2><p>Promise：对异步状态进行管理，解决异步的一些问题。</p>
<h3 id="Promise：上个接口成功后再请求下一个（如实现省市区功能）"><a href="#Promise：上个接口成功后再请求下一个（如实现省市区功能）" class="headerlink" title="Promise：上个接口成功后再请求下一个（如实现省市区功能）"></a>Promise：上个接口成功后再请求下一个（如实现省市区功能）</h3><p>以省市区的异步调用为例，并且把选中的值传递给下一个异步接口请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">new Promise((resolve, reject) =&gt; &#123;  // resolve 成功时的回调函数，reject 失败时的回调函数</span><br><span class="line">    ajax(&apos;省接口地址&apos;, res =&gt; &#123;  // ajax是上文中一个封装好的接口请求</span><br><span class="line">        resolve(&apos;我是省 请求成功了&apos;)  // 成功时 选中的值只需要在resolve中作为参数传递就行</span><br><span class="line"></span><br><span class="line">        &lt;!-- reject(&apos;我是省,但是请求失败了&apos;) --&gt;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).then((res) =&gt; &#123;  // res是接收上一个异步操作的形参</span><br><span class="line">    console.log(&apos;成功&apos;, res)</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        ajax(&apos;市的接口&apos;, (res) =&gt; &#123;</span><br><span class="line">            resolve()  // 手动调用resolve()，让函数进入到成功里</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, (err) =&gt; &#123;  // 这个可以省略</span><br><span class="line">    console.log(&apos;失败&apos;, err)</span><br><span class="line">&#125;).then((res) =&gt; &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        ajax(&apos;区的接口&apos;, (res) =&gt; &#123;</span><br><span class="line">            resolve() </span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).then(res =&gt; &#123;</span><br><span class="line">    console.log(res)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>封装后： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function getPromise(url) &#123;</span><br><span class="line">    return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        ajax(url, res =&gt; &#123;</span><br><span class="line">            resolve(res)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getPromise(&apos;省接口地址&apos;).then(res =&gt; &#123;  </span><br><span class="line">    console.log(res)</span><br><span class="line">    return getPromise(&apos;市接口地址&apos;)</span><br><span class="line">&#125;).then(res =&gt; &#123;</span><br><span class="line">    return getPromise(&apos;区接口地址&apos;)</span><br><span class="line">&#125;).then(res =&gt; &#123;</span><br><span class="line">    console.log(res)</span><br><span class="line">&#125;).catch(err =&gt; &#123;  // 这个catch是针对上文ajax封装后failCallback参数做为统一的错误出口进行拦截</span><br><span class="line">    console.log(&apos;对错误统一处理&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这种通过Promise可以更好地对Callback Hell(回调深渊/回调地狱) 进行处理</p>
<p>小注意点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let p = new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    console.log(1)</span><br><span class="line">    resolve()</span><br><span class="line">&#125;) </span><br><span class="line">console.log(2)</span><br><span class="line">p.then(() =&gt; &#123;</span><br><span class="line">    console.log(3)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>执行结果是1，2，3。当new Promise是会立即执行。.then相当于是成功时的一个回调函数具有异步性</p>
<h3 id="Promise-all：-实现所有接口都完成后再去执行某个事情（如上传完三张图片后在做某事）"><a href="#Promise-all：-实现所有接口都完成后再去执行某个事情（如上传完三张图片后在做某事）" class="headerlink" title="Promise.all： 实现所有接口都完成后再去执行某个事情（如上传完三张图片后在做某事）"></a>Promise.all： 实现所有接口都完成后再去执行某个事情（如上传完三张图片后在做某事）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const imgArr = [&apos;1.png&apos;,&apos;2.png&apos;,&apos;3.png&apos;]</span><br><span class="line">let promiseArr = []</span><br><span class="line">imgArr.forEach(item =&gt; &#123;</span><br><span class="line">    promiseArr.push(new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        // 图片上传的操作</span><br><span class="line">        resolve(url)  // url是上传3张图片后端返回的地址</span><br><span class="line">    &#125;))</span><br><span class="line">&#125;)</span><br><span class="line">Promise.all(promiseArr).then(res =&gt; &#123;</span><br><span class="line">    console.log(&apos;图片全部上传成功&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="异步编程解决方案二：Async-Await"><a href="#异步编程解决方案二：Async-Await" class="headerlink" title="异步编程解决方案二：Async Await"></a>异步编程解决方案二：Async Await</h2><p>Async Await：相对Promise来说更加的语义化和更加优雅。写法：Async放在function关键字前面，Await放在函数里面，他们需要成对出现。</p>
<p>当使用 Async Await解决异步时，await是等待的意思后面跟着的是异步操作。加上await后相当于这个需要等待异步操作完成后才能执行下一步。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function timeout() &#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            console.log(&apos;1&apos;)</span><br><span class="line">            resolve()</span><br><span class="line">        &#125;, 1000)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">async function foo() &#123;</span><br><span class="line">    await timeout()  // 1，2   await后面接着的是异步操作，加上await后相当于需要等待这个异步操作结束后才会执行下一步</span><br><span class="line">    console.log(&apos;2&apos;)</span><br><span class="line">&#125;</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>实例，如 省市区 的解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import ajax from &apos;./xxx/ajax.js&apos;  // ajax是已经封装好的axios接口组件</span><br><span class="line">function request(url) &#123;</span><br><span class="line">    return new Promise(resolve =&gt; &#123;</span><br><span class="line">        ajax(url, res =&gt; &#123;</span><br><span class="line">            resolve(res)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">async function getData() &#123;</span><br><span class="line">    const res1 = await request(&apos;省url地址&apos;)  // 因为用了async和await所以就会先执行完res1才会执行下一个市接口请求</span><br><span class="line">    console.log(res1)</span><br><span class="line">    const res2 = await request(&apos;市url地址&apos;)</span><br><span class="line">    console.log(res2)</span><br><span class="line">    const res3 = await request(&apos;取url地址&apos;)</span><br><span class="line">    console.log(res3)</span><br><span class="line">&#125;</span><br><span class="line">getData()</span><br></pre></td></tr></table></figure>

<h2 id="异步编程解决方案三：Generator"><a href="#异步编程解决方案三：Generator" class="headerlink" title="异步编程解决方案三：Generator"></a>异步编程解决方案三：Generator</h2><p>特点:</p>
<ul>
<li>有一个 *</li>
<li>里面有关键字 yield</li>
</ul>
<h2 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h2><ul>
<li>是一种接口机制，为各种不同的数据结构提供统一访问机制</li>
<li>主要供for…of消费</li>
<li>一句话：不支持遍历的数据结构”可遍历“</li>
</ul>
<h2 id="模块化-Module"><a href="#模块化-Module" class="headerlink" title="模块化 Module"></a>模块化 Module</h2><h3 id="export-–-import"><a href="#export-–-import" class="headerlink" title="export – import {}"></a>export – import {}</h3><p>导出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const a = &apos;2&apos;</span><br><span class="line">const lzzhy = &#123;</span><br><span class="line">    name: &apos;liting&apos;,</span><br><span class="line">    age: 18</span><br><span class="line">&#125;</span><br><span class="line">export &#123; a, lzzhy &#125;</span><br></pre></td></tr></table></figure>

<p>导入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; a, lzzhy &#125; from &apos;./xx&apos;</span><br></pre></td></tr></table></figure>

<h3 id="export-default-–-import"><a href="#export-default-–-import" class="headerlink" title="export default – import"></a>export default – import</h3><p>导出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">functiom sum(x,y) &#123;</span><br><span class="line">    return x + y</span><br><span class="line">&#125;</span><br><span class="line">export default sum</span><br></pre></td></tr></table></figure>

<p>导入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import sum from &apos;./xx&apos;  // sum这个可以自己改其他的名字</span><br></pre></td></tr></table></figure>

<p>第四章结束</p>
<h2 id="es新特性在vue中的应用"><a href="#es新特性在vue中的应用" class="headerlink" title="es新特性在vue中的应用"></a>es新特性在vue中的应用</h2><h3 id="依赖包安装及使用"><a href="#依赖包安装及使用" class="headerlink" title="依赖包安装及使用"></a>依赖包安装及使用</h3><p>在vue-cli脚手架创建的项目中。在package.json里，dependencies里的是生产环境的，安装时要加<code>--save</code>。devDependencies里的是开发环境需要的，安装时要加<code>--save -dev</code>。</p>
<p>当要使用这些包时，需要导出，如：<code>import axios from &#39;axios&#39;</code></p>
<h3 id="es新特性实现组件按需加载"><a href="#es新特性实现组件按需加载" class="headerlink" title="es新特性实现组件按需加载"></a>es新特性实现组件按需加载</h3><h4 id="点击对应路由时加载这个路由的对应页面："><a href="#点击对应路由时加载这个路由的对应页面：" class="headerlink" title="点击对应路由时加载这个路由的对应页面："></a>点击对应路由时加载这个路由的对应页面：</h4><p>在vue项目中，当点击一个按钮进入另一个页面时，这个事件也可以实现按需加载（当点击对应路由时才加载对应的页面，而不是一开始就将路由文件中的所以页面都加载出来）。<br>在router.js中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        path: &apos;/upload&apos;,</span><br><span class="line">        name: upload,</span><br><span class="line">        component: () =&gt; import(&apos;upload页面路径&apos;)  // 这样写就是实现整个页面的按需加载，只有当点击/upload路由时才会去加载对应的这个页面。</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/websocket，你好吖/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/websocket，你好吖/" itemprop="url">websocket，你好吖</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-01-21T18:05:29+08:00">
                2021-01-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/websocket，你好吖/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/websocket，你好吖/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  512
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>初次接触 WebSocket 的人，都会问同样的问题：我们已经有了 HTTP 协议，为什么还需要另一个协议？它能带来什么好处？</p>
<p>首先对于<br>HTTP:</p>
<ul>
<li>无法监听连续性的变化</li>
<li>效率低下</li>
<li>浪费资源</li>
</ul>
<p>WebSocket：是一种网络传输协议，可在单个 TCP 连接上进行全双工通信，位于 OSI 模型的应用层。</p>
<ul>
<li>TCP连接，与 HTTP 协议兼容</li>
<li>双向通信，主动推送（服务端向客户端）</li>
<li>节省服务器资源和带宽</li>
<li>实时通信</li>
<li>无同源限制，协议标识符是ws（加密wss）</li>
</ul>
<p>应用场景：</p>
<ul>
<li>聊天，消息，点赞</li>
<li>直播评论（弹幕）</li>
<li>游戏，协同编辑，基于位置的应用</li>
</ul>
<p>websocket 在前端来说主要有 open、close、error、message几个事件</p>
<h2 id="创建聊天室"><a href="#创建聊天室" class="headerlink" title="创建聊天室"></a>创建聊天室</h2><p>创建连接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div class=&quot;websocket-page&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; placeholder=&quot;请输入消息&quot; v-model=&quot;msg&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            msg: &apos;&apos;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">        const socket = new WebSocket(&apos;ws://localhost:8080&apos;);  // ws可以改成wss意思为加密（跟http和https一个意思）</span><br><span class="line"></span><br><span class="line">        &lt;!-- 通过 addEventListener 监听绑定事件： --&gt;</span><br><span class="line">        ws.addEventListener(&apos;open&apos;, this.handleOpen.bind(this), false)  // 通过bind改变this的指向</span><br><span class="line">        ws.addEventListener(&apos;close&apos;, this.handleClose.bind(this), false)</span><br><span class="line">        ws.addEventListener(&apos;error&apos;, this.handleError.bind(this), false)</span><br><span class="line">        ws.addEventListener(&apos;message&apos;, this.handleMessage.bind(this), false)</span><br><span class="line">    &#125;</span><br><span class="line">    methods() &#123;</span><br><span class="line">        handleOpen() &#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        handleClose() &#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        handleError() &#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        handleMessage() &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>项目中：（Normandy-web: menuDetail父组件，chatRoom聊天室组件）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">enterRoom(wssurl) &#123;</span><br><span class="line">    if(!wssurl) return</span><br><span class="line">    let self = this;</span><br><span class="line">    this.wsLink = new WebSocket(wssurl);</span><br><span class="line">    this.wsLink.onopen = function(evt) &#123;</span><br><span class="line">        self.socketStatus = true;				</span><br><span class="line">		self.getChatMsgList();</span><br><span class="line">		self.heartbeatFun = setInterval(self.heartbeat, 10000)</span><br><span class="line">	&#125;;</span><br><span class="line">	this.wsLink.onmessage = function(evt) &#123;</span><br><span class="line">        let res = JSON.parse(evt.data);</span><br><span class="line">        if (res.event === &quot;BROADCAST_MESSAGE&quot;) &#123;</span><br><span class="line">            self.uploadMsgList(res.data);</span><br><span class="line">            if(res.data.messageResource === &apos;CASE_CIRCULATION_AUTO_INPUT&apos; &amp;&amp; res.data.sender &amp;&amp; res.data.sender.memberName !== &apos;&apos;)&#123;</span><br><span class="line">				self.reserveVideo = res.data</span><br><span class="line">				self.reserveVideo.messageContent = JSON.parse(self.reserveVideo.messageContent)</span><br><span class="line">                self.joinVideoFlag = true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (res.event === &quot;LIST_MESSAGE&quot;) &#123;</span><br><span class="line">            self.getListMessage(res.data)</span><br><span class="line">        &#125; else if (res.event === &quot;ROOM&quot;) &#123;</span><br><span class="line">            self.initRoomConfig(res.data)</span><br><span class="line">            self.chatRoomMember = res.data.members</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket" target="_blank" rel="noopener">《webSocket官方文档》</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/Vue-项目搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Vue-项目搭建/" itemprop="url">Vue 项目搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-01-14T11:02:39+08:00">
                2021-01-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/Vue-项目搭建/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/Vue-项目搭建/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2.7k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在拿到一个新项目时，一般来说我们可以直接通过vue-cli脚手架生成一个项目结构就可以开始写业务代码了。但是往往出于对团队的协作能力以及后期的维护等等这些原因考虑我们会选择对一些常用的进行封装或者说全局配置，比如会对axios进行统一的接口封装（当然其中又会涉及很多其他的点，如：不同环境域名配置，请求头配置，接口状态封装，页面import引入封装。。。）</p>
<p>项目搭建中，一般还会对以下几个部分进行处理：</p>
<ul>
<li>通过<a href="https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create" target="_blank" rel="noopener">vue-cli</a>创建并初始化项目</li>
<li>封装<a href="https://github.com/axios/axios" target="_blank" rel="noopener">axios</a>接口（包括不同环境域名配置，请求头配置，接口状态封装，页面import引入封装）</li>
<li>引入组件库（我这里用的是<a href="https://element.eleme.cn/#/zh-CN/component/installation" target="_blank" rel="noopener">element-ui</a>，包括设置全局色值） </li>
<li><a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html" target="_blank" rel="noopener">vue-router</a>（包括路由管理、导航守卫）</li>
<li>数据存储/清空问题（登录后或者其他情况时）</li>
<li>npm 脚本设置</li>
</ul>
<h2 id="项目最终目录结构"><a href="#项目最终目录结构" class="headerlink" title="项目最终目录结构"></a>项目最终目录结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── babel.config.js</span><br><span class="line">├── package-lock.json</span><br><span class="line">├── package.json</span><br><span class="line">├── public</span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   └── index.html</span><br><span class="line">└── src</span><br><span class="line">    ├── App.vue</span><br><span class="line">    ├── api</span><br><span class="line">    │   └── login.js</span><br><span class="line">    ├── assets</span><br><span class="line">    │   └── images</span><br><span class="line">    ├── components</span><br><span class="line">    ├── config</span><br><span class="line">    │   ├── index.js</span><br><span class="line">    │   └── router.js</span><br><span class="line">    ├── layout</span><br><span class="line">    │   └── home.vue</span><br><span class="line">    ├── main.js</span><br><span class="line">    ├── router</span><br><span class="line">    │   ├── index.js</span><br><span class="line">    │   └── modules</span><br><span class="line">    ├── utils</span><br><span class="line">    │   ├── axios.js</span><br><span class="line">    │   ├── errorHandle.js</span><br><span class="line">    │   ├── request.js</span><br><span class="line">    │   ├── router.js</span><br><span class="line">    │   └── utils.js</span><br><span class="line">    └── views</span><br><span class="line">        ├── home.vue</span><br><span class="line">        └── login.vue</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注：<br>tree 可以自动生成目录结构，安装依赖：<code>brew install tree</code><br>执行命令生成树状目录结构：<code>tree -L 3 -I &quot;node_modules&quot;  // &#39;3&#39;是指要几层，&quot;node_modules&quot;指过滤掉的</code></p>
</blockquote>
<h2 id="通过vue-cli创建并初始化项目"><a href="#通过vue-cli创建并初始化项目" class="headerlink" title="通过vue-cli创建并初始化项目"></a>通过vue-cli创建并初始化项目</h2><p>利用脚手架创建项目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名</span><br></pre></td></tr></table></figure>

<p>脚手架生成项目结构后，手动删除初始化生成的一些多余页面。</p>
<p>注：若创建项目后本地自动有关联仓库的话（没有手动关联仓库，可是本地会显示待提交的文件）就执行：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf .git</span><br></pre></td></tr></table></figure></p>
<h2 id="封装axios接口"><a href="#封装axios接口" class="headerlink" title="封装axios接口"></a>封装<a href="https://github.com/axios/axios" target="_blank" rel="noopener">axios</a>接口</h2><h3 id="封装axios的流程"><a href="#封装axios的流程" class="headerlink" title="封装axios的流程"></a>封装axios的流程</h3><p>1.首先安装axios：<br>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install axios</span><br></pre></td></tr></table></figure></p>
<p>2.新建 utils 文件夹和里面的 axios.js 并在 main.js 中引入这个utils/axios.js。</p>
<p>utils =&gt; axios.js：（将<a href="https://github.com/axios/axios" target="_blank" rel="noopener">axios</a> 上的这段复制下来，并封装在了HttpRequest中 ）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">// 封装axios的请求，返回重新封装的数据格式</span><br><span class="line">// 需要对返回的错误code码进行统一处理</span><br><span class="line">import axios from &apos;axios&apos;</span><br><span class="line">import errorHandle from &apos;./errorHandle&apos;  // 也是在utils中自己封装的一个方法</span><br><span class="line"></span><br><span class="line">class HttpRequest &#123;</span><br><span class="line">    constructor(baseURL) &#123;</span><br><span class="line">        this.baseURL = baseURL</span><br><span class="line">    &#125;</span><br><span class="line">    // 获取axios的配置</span><br><span class="line">    getInsideConfig() &#123;</span><br><span class="line">        const config = &#123;</span><br><span class="line">            baseURL: this.baseURL,</span><br><span class="line">            headers: &#123;</span><br><span class="line">                &apos;Content-Type&apos;: &apos;application/json;chartset=utf-8&apos;,</span><br><span class="line">            &#125;,</span><br><span class="line">            timeout: 10000  // 请求超过10s默认失败，请求超时</span><br><span class="line">        &#125;</span><br><span class="line">        return config;</span><br><span class="line">    &#125;</span><br><span class="line">    // 设定拦截器</span><br><span class="line">    interceptors(instance) &#123;</span><br><span class="line">        // 将axios github上的这段复制下来 </span><br><span class="line">        // 并用instance替换axios</span><br><span class="line"></span><br><span class="line">        // 请求拦截器</span><br><span class="line">        instance.interceptors.request.use((config) =&gt; &#123;</span><br><span class="line">            console.log(&apos;发送请求&apos;);</span><br><span class="line">            return config;</span><br><span class="line">        &#125;, (err) =&gt; &#123;</span><br><span class="line">            errorHandle(err)</span><br><span class="line">            return Promise.reject(err);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        // 响应请求的拦截器</span><br><span class="line">        instance.interceptors.response.use((res) =&gt; &#123;</span><br><span class="line">            // 处理响应成功的</span><br><span class="line">            console.log(&apos;请求回来的&apos;);</span><br><span class="line">            if (res.status === 200) &#123;</span><br><span class="line">                return Promise.resolve(res.data)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                return Promise.reject(res.data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, (err) =&gt; &#123;</span><br><span class="line">            // 对返回的错误code码进行统一处理</span><br><span class="line">            errorHandle(err)</span><br><span class="line">            return Promise.reject(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    // 创建实例</span><br><span class="line">    request(options) &#123;</span><br><span class="line">        const instance = axios.create()</span><br><span class="line">        const newOptions = Object.assign(this.getInsideConfig(), options)</span><br><span class="line">        this.interceptors(instance)</span><br><span class="line">        return instance.request(newOptions)</span><br><span class="line">    &#125;</span><br><span class="line">    // get方法封装</span><br><span class="line">    get (url,config) &#123;</span><br><span class="line">        const options = Object.assign(&#123;</span><br><span class="line">            method: &apos;get&apos;,</span><br><span class="line">            url: url</span><br><span class="line">        &#125;, config)</span><br><span class="line">        return this.request(options)</span><br><span class="line">    &#125;</span><br><span class="line">    // post方法封装</span><br><span class="line">    post (url,data, ...config) &#123;  // data是post请求时带的json数据</span><br><span class="line">        return this.request(&#123;</span><br><span class="line">            method: &apos;post&apos;,</span><br><span class="line">            url: url,</span><br><span class="line">            data: data,</span><br><span class="line">            ...config</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default HttpRequest  // 导出HttpRequest</span><br></pre></td></tr></table></figure>

<p>现在已经把最基础的前置守卫封装在类里了，并且导出了HttpRequest</p>
<p>3.HttpRequest 导出后，就可以在utils/request.js中实例化axios并导出axios：<br>utils =&gt; request.js： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import HttpRequest from &apos;./axios&apos;</span><br><span class="line">import config from &apos;@/config&apos;  // 引入配置文件 取到里面的baseUrl</span><br><span class="line">const baseURL = process.env.NODE_ENV === &apos;development&apos; ? config.baseURL.dev : config.baseURL.process   // 把@config中的baseUrl传递过去</span><br><span class="line"></span><br><span class="line">const axios = new HttpRequest(baseURL)  // 实例化axios,并将baseUrl传进去</span><br><span class="line"></span><br><span class="line">export default axios  // 导出axios</span><br></pre></td></tr></table></figure>

<p>4.那么现在就可以使用封装好的axios在进行接口的封装了：<br>api =&gt; login.js： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import axios from &apos;@/utils/request&apos;  // 引入封装好的axios</span><br><span class="line"></span><br><span class="line">const test = () =&gt; &#123;  // 接口</span><br><span class="line">    return axios.get(&apos;/test&apos;)  </span><br><span class="line">&#125;</span><br><span class="line">const login = () =&gt; &#123;</span><br><span class="line">    return axios.post(&apos;/save&apos;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export &#123; test, login &#125;</span><br></pre></td></tr></table></figure>

<p>5.那么现在我们可以在页面中来测试使用接口是否能调通了：</p>
<p>get方法，在.vue文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import &#123; test &#125; from &apos;@/api/login&apos;</span><br><span class="line">test().then(res =&gt; &#123;</span><br><span class="line">    console.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>post 方法，在.vue文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; login &#125; from &apos;@/api/login&apos;</span><br><span class="line">const params = &#123;</span><br><span class="line">    phone: this.loginForm.phone,</span><br><span class="line">    password: this.loginForm.password</span><br><span class="line">&#125;</span><br><span class="line">login(params).then(res =&gt; &#123;</span><br><span class="line">    console.log(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="接口状态封装"><a href="#接口状态封装" class="headerlink" title="接口状态封装"></a>接口状态封装</h3><p>待开发</p>
<h3 id="页面import引入接口封装"><a href="#页面import引入接口封装" class="headerlink" title="页面import引入接口封装"></a>页面import引入接口封装</h3><p>待开发</p>
<h2 id="引入组件库element-ui"><a href="#引入组件库element-ui" class="headerlink" title="引入组件库element-ui"></a>引入组件库<a href="https://element.eleme.cn/#/zh-CN/component/installation" target="_blank" rel="noopener">element-ui</a></h2><p>1.npm 安装：<code>npm i element-ui -S</code></p>
<p>2.引入 Element：</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/Vue%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%85%8D%E7%BD%AE/WechatIMG7.png" alt="cmd-markdown-logo"></p>
<p>上面这个截图是<a href="https://element.eleme.cn/#/zh-CN/component/quickstart" target="_blank" rel="noopener">element-ui快速上手</a>中的完整引入，文档中也有部分引入的说明，具体的看文档。</p>
<p>好了，这样就完成了组件库的引入。</p>
<h3 id="设置全局样式"><a href="#设置全局样式" class="headerlink" title="设置全局样式"></a>设置全局样式</h3><p>app.vue： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">html &#123;</span><br><span class="line">    /* 获取整个屏幕大小 */</span><br><span class="line">    height: 100vh;  </span><br><span class="line">&#125;</span><br><span class="line">body, #app &#123;</span><br><span class="line">    height: 100%;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置全局统一的色值"><a href="#配置全局统一的色值" class="headerlink" title="配置全局统一的色值"></a>配置全局统一的色值</h3><!-- 安装：node-sass 和 sass-loader(版本为7.几的话下图43行就用"data",版本不为7.几的话43行就用"prependData") -->
<p>待开发</p>
<h2 id="vue-router"><a href="#vue-router" class="headerlink" title="vue-router"></a>vue-router</h2><h3 id="路由管理（一般页面少的情况下可以直接这样，路由都放在router-gt-index-js一个文件中）"><a href="#路由管理（一般页面少的情况下可以直接这样，路由都放在router-gt-index-js一个文件中）" class="headerlink" title="路由管理（一般页面少的情况下可以直接这样，路由都放在router =&gt; index.js一个文件中）"></a>路由管理（一般页面少的情况下可以直接这样，路由都放在router =&gt; index.js一个文件中）</h3><p>入口文件 App.vue：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">        &lt;router-view /&gt;  // router中的配置会印射进来</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<p>路由配置 router =&gt; index.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import Login from &apos;../views/login.vue&apos;</span><br><span class="line">import Home from &apos;../views/home.vue&apos;</span><br><span class="line">const routes = [</span><br><span class="line">    &#123;</span><br><span class="line">        path: &apos;/&apos;,  // 根路由会印射在App.vue里面，默认该页面是进网站的第一个页面</span><br><span class="line">        name: &apos;Login&apos;,</span><br><span class="line">        component: Login</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: &apos;/Home&apos;,</span><br><span class="line">        name: &apos;Home&apos;,</span><br><span class="line">        component: Home</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="路由拦截-又叫导航守卫-（路由分了模块放在不同的js文件中，这边对router-gt-modules中的所有路由js页面做了配置，可以拿到router-gt-modules中所有的路由）"><a href="#路由拦截-又叫导航守卫-（路由分了模块放在不同的js文件中，这边对router-gt-modules中的所有路由js页面做了配置，可以拿到router-gt-modules中所有的路由）" class="headerlink" title="路由拦截(又叫导航守卫)（路由分了模块放在不同的js文件中，这边对router =&gt; modules中的所有路由js页面做了配置，可以拿到router =&gt; modules中所有的路由）"></a>路由拦截(又叫导航守卫)（路由分了模块放在不同的js文件中，这边对router =&gt; modules中的所有路由js页面做了配置，可以拿到router =&gt; modules中所有的路由）</h3><p>utils =&gt; router.js（ 这个里面就是<a href="https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB" target="_blank" rel="noopener">vue-router路由拦截</a>）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &apos;vue&apos;</span><br><span class="line">import Router from &apos;vue-router&apos;</span><br><span class="line">import ROUTES from &apos;@/router/index&apos;  // 见下面封装</span><br><span class="line">import &#123; ROUTER_DEFAULT_CONFIG &#125; from &apos;@/config/index&apos;  // 见下面封装</span><br><span class="line">import &#123; routerBeforeEachFunc &#125; from &apos;@/config/router&apos;  // 见下面封装</span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line">// 注入默认配置和路由表</span><br><span class="line">let routerInstance = new Router(&#123;</span><br><span class="line">    ...ROUTER_DEFAULT_CONFIG,  // 默认配置</span><br><span class="line">    routes: ROUTES  // 路由表</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">routerInstance.beforeEach(routerBeforeEachFunc)  // routerBeforeEachFunc 是beforeEach的参数</span><br><span class="line"></span><br><span class="line">export default routerInstance  // 导出前置守卫</span><br></pre></td></tr></table></figure>

<p>以上这是一个总的路由拦截的写法，那几个引入的文件都是把它单个的封装出去了，具体封装的见下面：</p>
<p>router =&gt; index.js： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import &#123; importAll &#125; from &apos;@/utils/utils&apos;</span><br><span class="line"></span><br><span class="line">const routeModules = importAll(  // importAll这样可以匹配到@/router/modules下的路由，就可以把路由按照模块来写不用堆在一个文件中</span><br><span class="line">    require.context(&apos;@/router/modules&apos;, false, /\.js$/)</span><br><span class="line">)</span><br><span class="line">const routes = routeModules.reduce(</span><br><span class="line">    (finallRoutes, routerModule) =&gt;</span><br><span class="line">        finallRoutes.concat(routerModule.module),</span><br><span class="line">    []</span><br><span class="line">)</span><br><span class="line">export default routes  // 导出的router按模块划分写在不同的js页面里</span><br></pre></td></tr></table></figure>

<p>utils =&gt; utils.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const fileNameRE = /^\.\/([^\s]+)\.js$/</span><br><span class="line">export function importAll(modulesContext) &#123;  // importAll router/index.js中引入的 </span><br><span class="line">    return modulesContext.keys().map((modulesPath) =&gt; &#123;</span><br><span class="line">        const moduleName = modulesPath.match(</span><br><span class="line">            fileNameRE</span><br><span class="line">        )</span><br><span class="line">        return &#123;</span><br><span class="line">            moduleName,</span><br><span class="line">            camelModuleName: moduleName[1].replace(</span><br><span class="line">                /-(\w)/g,</span><br><span class="line">                (_, c) =&gt; (c ? c.toUpperCase() : &apos;&apos;)</span><br><span class="line">            ),</span><br><span class="line">            module: modulesContext(modulesPath).default</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>config =&gt; index.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 路由默认配置，路由表并不从此注入</span><br><span class="line">export const ROUTER_DEFAULT_CONFIG = &#123;  // history 模式</span><br><span class="line">    mode: &apos;history&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>config =&gt; router.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 在这里面处理一些页面拦截，权限处理之类的</span><br><span class="line">export function routerBeforeEachFunc(to, from, next) &#123;</span><br><span class="line">    if(to.matched.some(record =&gt; record.meta.requireAuth)) &#123;  // 判断该路由是否需要登录权限</span><br><span class="line">        // let loginInfo = window.localStorage.getItem(&quot;loginUserInfo&quot;)</span><br><span class="line">        // if(loginInfo) &#123;  // 判断该路由是否需要登录权限</span><br><span class="line">        //     next()</span><br><span class="line">        // &#125; else &#123;</span><br><span class="line">        //     next(&#123;</span><br><span class="line">        //         path: &apos;/home&apos;,</span><br><span class="line">        //         query: &#123; redirect: to.fullPath &#125;  // 将跳转的路由path作为参数，登录成功后跳转到该路由</span><br><span class="line">        //     &#125;)</span><br><span class="line">        // &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        next()</span><br><span class="line">    &#125;</span><br><span class="line">    next()</span><br></pre></td></tr></table></figure>

<p>最后在main.js中注入这个经过处理的拦截router：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import router from &apos;@/utils/router.js&apos;</span><br><span class="line">new Vue(&#123;</span><br><span class="line">  router  // 注入router</span><br><span class="line">&#125;).$mount(&apos;#app&apos;)</span><br></pre></td></tr></table></figure>

<p>好了，那么需要写入路由的话。router =&gt; modules =&gt; index.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const App = () =&gt;</span><br><span class="line">    import (&apos;@/layout/home.vue&apos;)  // 需要一个壳子</span><br><span class="line">const Login = () =&gt; import(&apos;@/views/login.vue&apos;)  // 可以写成这种写法，原本是 import Login from &apos;../../views/login.vue&apos; </span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    path: &quot;/&quot;,</span><br><span class="line">    component: App,  // App 需要在上面引入,是一个嵌套页面的壳子</span><br><span class="line">    redirect: &quot;/Login&quot;,</span><br><span class="line">    meta: &#123;</span><br><span class="line">        title: &quot;&quot;,</span><br><span class="line">        requireAuth: false, // 添加该字段，表示进入这个路由是需要登录的</span><br><span class="line">        isback: true</span><br><span class="line">    &#125;,</span><br><span class="line">    children: [</span><br><span class="line">        &#123;</span><br><span class="line">            path: &quot;/Login&quot;,</span><br><span class="line">            meta: &#123;</span><br><span class="line">                title: &apos;登录页&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            component: Login</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好了，这样路由拦截就完成了</p>
<h2 id="ESLint-配置"><a href="#ESLint-配置" class="headerlink" title="ESLint 配置"></a>ESLint 配置</h2><h3 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h3><p>可以在创建项目的时候就选择使用eslint。但是那是默认的eslint，要是想在默认的基础上修改或者添加一些自己的配置呢：<br>package.json中(创建项目时选择了把eslint放在package.json中)</p>
<p>新增缩进4格配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;eslintConfig&quot;: &#123;</span><br><span class="line">    &quot;rules&quot;: &#123;</span><br><span class="line">        &quot;indent&quot;: [1, 4]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改<code>定义了但是未使用</code>(这个是eslint默认的)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;eslintConfig&quot;: &#123;</span><br><span class="line">    &quot;rules&quot;: &#123;</span><br><span class="line">        &quot;no-unused-vars&quot;: 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当想要不校验某一行的eslit是否符合规范时，可以在这句的上一行添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// eslint-disable-next-line</span><br></pre></td></tr></table></figure>

<h3 id="本地vscode实现：保存代码时代码自动对齐"><a href="#本地vscode实现：保存代码时代码自动对齐" class="headerlink" title="本地vscode实现：保存代码时代码自动对齐"></a>本地vscode实现：保存代码时代码自动对齐</h3><p><a href="https://juejin.cn/post/6892000216020189198/#heading-0" target="_blank" rel="noopener">ESlint + stylelint + VSCode自动格式化代码</a></p>
<h2 id="数据存储-数据清除等"><a href="#数据存储-数据清除等" class="headerlink" title="数据存储/数据清除等"></a>数据存储/数据清除等</h2><p>数据存储时可以保存在 localStorage 或者 sessionstorage，以下将方法封装在 utils/utils.js 中：</p>
<p>localStorage：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 存储localStorage</span><br><span class="line">export const setStore = (name, content) =&gt; &#123;</span><br><span class="line">    if(!name) return;</span><br><span class="line">    if(typeof content !== &apos;string&apos;) &#123;</span><br><span class="line">        content = JSON.stringify(content);</span><br><span class="line">    &#125;</span><br><span class="line">    window.localStorage.setItem(name,content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取localStorage</span><br><span class="line">export const getStore = name =&gt; &#123;</span><br><span class="line">    if(!name) return;</span><br><span class="line">    return window.localStorage.getItem(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 清除localStorage</span><br><span class="line">export const removeStore = name =&gt; &#123;</span><br><span class="line">    if(!name) return;</span><br><span class="line">    window.localStorage.removeItem(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sessionstorage：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//  存储sessionstorage</span><br><span class="line">export const setStoreSession = (name,content) =&gt; &#123;</span><br><span class="line">    if(!name) return;</span><br><span class="line">    if(typeof content !== &apos;string&apos;) &#123;</span><br><span class="line">        content = JSON.stringify(content)</span><br><span class="line">    &#125;</span><br><span class="line">    window.sessionStorage.setItem(name,content)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 获取sessionStorage</span><br><span class="line">export const getStoreSession = name =&gt; &#123;</span><br><span class="line">    if (!name) return;</span><br><span class="line">    return window.sessionStorage.getItem(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 清除sessionStorage</span><br><span class="line">export const removeStoreSession = name =&gt; &#123;</span><br><span class="line">    if(!name) return;</span><br><span class="line">    window.sessionStorage.removeItem(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用方法：以localStorage为例，在.vue页面中如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- setStore --&gt;</span><br><span class="line">import &#123; setStore &#125; from &apos;@/utils/utils&apos;</span><br><span class="line">setStore(&apos;lzzhy&apos;, res);</span><br><span class="line"></span><br><span class="line">&lt;!-- getStore --&gt;</span><br><span class="line">import &#123; getStore &#125; from &apos;@/utils/utils&apos;</span><br><span class="line">JSON.parse(getStore(&apos;lzzhy&apos;))</span><br></pre></td></tr></table></figure>

<h2 id="npm-脚本设置"><a href="#npm-脚本设置" class="headerlink" title="npm 脚本设置"></a>npm 脚本设置</h2><p>待开发</p>
<h2 id="搭建项目过程中的问题"><a href="#搭建项目过程中的问题" class="headerlink" title="搭建项目过程中的问题"></a>搭建项目过程中的问题</h2><h3 id="vue-cli生成项目后可以直接用-引入文件"><a href="#vue-cli生成项目后可以直接用-引入文件" class="headerlink" title="vue-cli生成项目后可以直接用@引入文件"></a>vue-cli生成项目后可以直接用@引入文件</h3><p>之所以用‘@’，是因为偷了个懒利用3.x中/node_modules/@vue/cli-service/lib/config/base.js中已经配好的@路径,有兴趣的可以进入文件里面看一看</p>
<h3 id="Failed-to-resolve-loader-sass-loader"><a href="#Failed-to-resolve-loader-sass-loader" class="headerlink" title="Failed to resolve loader: sass-loader"></a>Failed to resolve loader: sass-loader</h3><p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/Vue%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA%E5%8F%8A%E9%85%8D%E7%BD%AE/WechatIMG6.png" alt="cmd-markdown-logo"></p>
<p>因为在项目中使用的是<code>&lt;style lang=&quot;scss&quot;&gt;</code>，发现会报上图这个错：不能解析saa-loader。解决方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install sass-loader node-sass -D  // 安装 sass-loader node-sass 依赖</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/koa + MongoDB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/koa + MongoDB/" itemprop="url">koa + MongoDB</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-01-04T17:27:20+08:00">
                2021-01-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/koa + MongoDB/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/koa + MongoDB/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.7k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>新年第一趴来咯！！！！</p>
<h2 id="为什么要学这个呢"><a href="#为什么要学这个呢" class="headerlink" title="为什么要学这个呢"></a>为什么要学这个呢</h2><p>现在越来越讲究 大前端，但是大前端究竟是什么呢？</p>
<p>我对大前端的理解：它至少有一个点是在现在前后端分离的趋势中可以脱离后端独立开发一个项目。由于 前端代码 + 数据库 + 后端代码 = 完整的一个项目，那么就有了我们本节所讲的Node.js(扮演后端)和 MongoDB(数据库)</p>
<p>对于为什么会选中 Node.js 和 MongoDB 呢？ </p>
<p>Node.js 是能够在服务器端运行 JavaScript 的开放源代码、跨平台 JavaScript 运行环境。</p>
<p>而 MongoDB 相较于其他关系型数据库相比来说具有以下的有点：</p>
<ul>
<li>弱一致性（最终一致），更能保证用户的访问速度</li>
<li>文档结构的存储方式，能够更便捷的获取数据</li>
<li>内置GridFS，支持大容量的存储</li>
<li>第三方支持丰富 (这是与其他的NoSQL相比，MongoDB也具有的优势)</li>
<li>性能优越</li>
</ul>
<h2 id="koa-和-MongoDB-是什么"><a href="#koa-和-MongoDB-是什么" class="headerlink" title="koa 和 MongoDB 是什么"></a>koa 和 MongoDB 是什么</h2><p>koa：官方的解释是基于Node.js平台的下一代web开发框架</p>
<p>MongoDB 是数据库本身，而 Mongoose 是 MongoDB 的对象建模工具（说白了就是基于前者之上进行功能封装的一个库，它们两者之间的关系类似Node.js和express或koa之间的关系）</p>
<p>二者之间的关系：使用 node.js 的框架 ( 比如koa ) 与数据库（  MongoDB ）建立连接并且操作数据库，node.js 框架给提供接口，提供的接口就是关联数据库里面的，最后渲染在前端页面上。</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>环境要求：node.js &gt; 7.6.0（可以使用 <a href="https://github.com/nvm-sh/nvm/blob/master/README.md" target="_blank" rel="noopener">nvm</a>：node.js版本控制工具）</p>
<h2 id="项目准备工作"><a href="#项目准备工作" class="headerlink" title="项目准备工作"></a>项目准备工作</h2><ul>
<li><p>新建项目文件夹：koa + MongoDB (根据自己爱好取o)</p>
</li>
<li><p>生成 package.json：npm init -y</p>
</li>
<li><p>安装相应的依赖：cnpm install koa koa-router –save (–save: 生成的在 dependencies 里)</p>
</li>
<li><p>在 package.json 里将 “main”: “index.js” 改成 “main”: “app.js”，入口文件就变成 app.js 了，在新建一个 app.js 文件作为入口文件(或者直接新增 index.js 并以这个文件作为入口)</p>
</li>
<li><p>在刚新增的 app.js 文件中引入和写逻辑(往下看，在下面的本地搭建里面哦)</p>
</li>
<li><p>启动项目：需要在 package.json 中配置，将 </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  修改为：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;start&quot;: &quot;node app.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  本来执行的命令是 node app.js,但是这里配置了的话执行命令写成 npm run start 就行了。(如对脚本配置有问题的可以参考 <a href="https://lzzhy.github.io/package.json%20%E4%B8%AD%E7%9A%84%20npm%20%E8%84%9A%E6%9C%AC(npm%20scripts)%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" target="_blank" rel="noopener">npm scripts</a> )</p>
</li>
<li><p>安装 nodemon 热更新启动时可以自动监听：需要在 package.json 中配置：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;nodemon&quot;: &quot;nodemon app.js&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  并且全局安装：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install -g nodemon</span><br></pre></td></tr></table></figure>

<p>  这样子启动项目的话就可以不用 npm run start (不会监听文件修改)，可以直接 nodemon (可以监听文件修改) 了，在浏览器打开localhost:4000(设置的端口号)就可以了。</p>
</li>
</ul>
<h2 id="搭建本地服务"><a href="#搭建本地服务" class="headerlink" title="搭建本地服务"></a>搭建本地服务</h2><p>app.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const koa = require(&quot;koa&quot;);  // 引入koa</span><br><span class="line">const Router = require(&quot;koa-router&quot;);  // 引入路由</span><br><span class="line"></span><br><span class="line">const app = new koa();  // 实例化koa</span><br><span class="line">const router = new Router();  // 实例化路由</span><br><span class="line"></span><br><span class="line">app.use(router.routes()).use(router.allowedMethods());  // 配置路由</span><br><span class="line"></span><br><span class="line">const port = process.env.PORT || 4000;  // 设置端口号 4000这个可以随便改成啥</span><br><span class="line">app.listen(port, () =&gt; &#123;  // 监听当前端口号</span><br><span class="line">    console.log(`serve started on $&#123;port&#125;`);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(&quot;/&quot;, async ctx =&gt; &#123;  // 路由 不同路由展示不同页面</span><br><span class="line">    ctx.body = &#123; msg: &quot;hello koa！I am coming!!&quot; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><p>上文提到过了 mongoose 是 MongoDB 的一个对象建模工具，因此我们要通过 mongoose 来实现koa连接 MongoDB 数据库。</p>
<p>安装 mongoose：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install mongoose --save</span><br></pre></td></tr></table></figure>

<p>连接数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mongoose.connect(&apos;mongodb://localhost:27017/phoneAlbumData&apos;, &#123; useUnifiedTopology: true, useNewUrlParser: true &#125;).then(() =&gt; &#123;  // &apos;mongodb://localhost:27017/&apos;是固定的，phoneAlbumData 是你创建的数据库的名称</span><br><span class="line">    console.log(&quot;数据库连接成功...&quot;);</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">    console.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>操作 npm run start,可以看到端口输出数据库连接成功。</p>
<p>连接数据库成功后，可以下载一个 Robo 3T（数据库可视化工具）并在里面查看或者操作数据：<a href="https://www.bbsmax.com/A/obzb7V2BJE/" target="_blank" rel="noopener">Robo 3T 使用教程</a></p>
<h2 id="RESTful接口创建"><a href="#RESTful接口创建" class="headerlink" title="RESTful接口创建"></a>RESTful接口创建</h2><p>mongoose通过 services（方法）,controlller（接口）,model（模型）这三层来实现接口的创建。</p>
<p>下面介绍接口创建的流程以及分别举例介绍一个 GET/POST 方法！</p>
<ul>
<li><p>首先在app.js中引入 controlller（接口） 层的接口</p>
<p>  controlller =&gt; api =&gt; users.js 目录： </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">const Router = require(&quot;koa-router&quot;);  // 引入 koa-router</span><br><span class="line">const router = new Router();  // 实例化 router</span><br><span class="line">const bacUserService = require(&quot;../../services/users&quot;)  // 引入 services 层方法</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* @route GET请求方式 api/users/test</span><br><span class="line">*/</span><br><span class="line">router.get(&quot;/test&quot;, async ctx =&gt; &#123;</span><br><span class="line">    ctx.status = 200;</span><br><span class="line">    ctx.body = &#123; msg: &apos;users works...&apos; &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* @route POST方法 api/users/save</span><br><span class="line">*/</span><br><span class="line">router.post(&quot;/save&quot;, async ctx =&gt; &#123;</span><br><span class="line">    const user = &#123;</span><br><span class="line">        &quot;phone&quot;:  &quot;15770535880&quot;,</span><br><span class="line">        &quot;password&quot;:  &quot;88888888&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    const data = await bacUserService.save(user);</span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">        data: data,</span><br><span class="line">        err_code: 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>来到了 services（方法层）：services =&gt; users.js</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">const userModel = require(&quot;../models/users&quot;)  // 引入 services 层</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line"></span><br><span class="line">    &lt;!-- ...封装的方法... --&gt;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>现在是model（模型）层，model =&gt; users.js 目录：</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const mongoose = require(&quot;mongoose&quot;)</span><br><span class="line">const Schema = mongoose.Schema  // Schema是模板</span><br><span class="line">const userSchema = new Schema(&#123;  // 实例化数据模板</span><br><span class="line">    phone: &#123;</span><br><span class="line">        type: Number</span><br><span class="line">    &#125;,</span><br><span class="line">    password: &#123;</span><br><span class="line">        type: Number</span><br><span class="line">    &#125;,</span><br><span class="line">    id: &#123;</span><br><span class="line">        type: String,</span><br><span class="line">        default: Date.now</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">module.exports = user = mongoose.model(&quot;users&quot;,userSchema)  // 导出</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后将model（模型）层导出的在app.js中引用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">router.use(&apos;/api/users&apos;, users)  // 接口地址 localhost:4000/api/users</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>好了，这样一个完整的本地服务操作数据库的就完成了（这里只举例了一个get和一个post接口，更多复杂的接口可以自己去探讨一下哦），撒花撒花！！！</p>
<h2 id="测试接口"><a href="#测试接口" class="headerlink" title="测试接口"></a>测试接口</h2><p>既然接口以及实现了，那可以借助 postman 这个测试工具来测试接口是否成功。</p>
<p>比如想要调用 save 接口的话：就在 postman 里面输入 localhost:4000/api/users/save，再选择 post 方法并且输入入参就可以啦。</p>
<p>同理 get 方法也一样：localhost:4000/api/users/get，选择get方法不需要传参</p>
<h2 id="数据库可视化工具"><a href="#数据库可视化工具" class="headerlink" title="数据库可视化工具"></a>数据库可视化工具</h2><p>当我们在 postman 里面测试了 POST接口的话，那么数据库里肯定存入了对应的数据，那么我们要怎么查看我们的数据库具体有哪些数据呢</p>
<p>这个时候就可以借助 Robo 3T 这个工具了，打开这个工具时候需要先创建一个对应的数据库名（这个数据库名就是链接数据库时创建的名字，如我们这里就是phoneAlbumData，因为之前连接数据库时设置了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongoose.connect(&apos;mongodb://localhost:27017/phoneAlbumData&apos;,...</span><br></pre></td></tr></table></figure>

<p>以上只是截取了部分重要的代码，具体的代码放在github上了</p>
<h2 id="在koa应用中支持es6的语法"><a href="#在koa应用中支持es6的语法" class="headerlink" title="在koa应用中支持es6的语法"></a>在koa应用中支持es6的语法</h2><p>使用webpack+babel解决</p>
<p>完美完美。</p>
<p>参考：<br><a href="https://koa.bootcss.com/" target="_blank" rel="noopener">koa官方文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/Axios接口请求/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Axios接口请求/" itemprop="url">接口请求</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-12-29T22:02:14+08:00">
                2020-12-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/Axios接口请求/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/Axios接口请求/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  589
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在前后端联调的过程中，会碰到不同方式的传参。</p>
<h2 id="路径-‘-‘-后面带参数的接口请求-path方式传参"><a href="#路径-‘-‘-后面带参数的接口请求-path方式传参" class="headerlink" title="路径 ‘/‘ 后面带参数的接口请求 path方式传参"></a>路径 ‘/‘ 后面带参数的接口请求 path方式传参</h2><h3 id="带一个参数"><a href="#带一个参数" class="headerlink" title="带一个参数"></a>带一个参数</h3><p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/Axios%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82/WechatIMG14.png" alt="cmd-markdown-logo"></p>
<p>api.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const showQrCode = (data, shortQrCodeUrl) =&gt; &#123;  // 有两个参数，并且入参shortQrCodeUrl和字符串模板里的一样</span><br><span class="line">    return request(`/sjzmt-backend-web/qrcode/showQrCode/$&#123;shortQrCodeUrl&#125;`, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>页面中使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; showQrCode &#125; from &apos;@/api&apos;</span><br><span class="line">showQrCode(&#123;shortQrCodeUrl: lastStr&#125;, lastStr).then((data = &#123;&#125;) =&gt; &#123;&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="带多个参数"><a href="#带多个参数" class="headerlink" title="带多个参数"></a>带多个参数</h3><p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/Axios%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82/WechatIMG6.png" alt="cmd-markdown-logo"></p>
<p>api.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export const searchDictionaryInfo = (type,level,data) =&gt; axios.post(`$&#123;url&#125;/dictionary/dictionaryList/$&#123;type&#125;/$&#123;level&#125;`, data)</span><br></pre></td></tr></table></figure>

<p>页面中使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import &#123; searchDictionaryInfo &#125; from &apos;@/api&apos;</span><br><span class="line"></span><br><span class="line">searchDictionaryInfo(&apos;dispute_type&apos;,2).then(res=&gt;   </span><br><span class="line">   if(res.code == 0)&#123;</span><br><span class="line"></span><br><span class="line">   &#125; else &#123;</span><br><span class="line">       this.$message.error(res.msg)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;, (err) =&gt; &#123;</span><br><span class="line">    this.$message.error(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="路径-‘-‘-后面不带参数的接口请求"><a href="#路径-‘-‘-后面不带参数的接口请求" class="headerlink" title="路径 ‘/‘ 后面不带参数的接口请求"></a>路径 ‘/‘ 后面不带参数的接口请求</h2><p>类似这种干净的不带参数的路径：<br><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/Axios%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82/WechatIMG7.png" alt="cmd-markdown-logo"></p>
<p>但是这种路径要注意观察swagger看标注的是query,body,header,path中的哪一个;几者的传参时的区别如下：</p>
<h3 id="body"><a href="#body" class="headerlink" title="body"></a>body</h3><p>body是最常见的：</p>
<p>api.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const getDisputeProcessList = (data) =&gt; &#123;  // 只有一个参数data</span><br><span class="line">    return request(&apos;/disputeProcess/getDisputeProcessList&apos;, data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>页面调用时：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; getDisputeProcessList &#125; from &apos;@/api&apos;</span><br><span class="line"></span><br><span class="line">const params = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">getDisputeProcessList(params).then((data = &#123;&#125;) =&gt; &#123;&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="query"><a href="#query" class="headerlink" title="query"></a>query</h3><h4 id="一个参数"><a href="#一个参数" class="headerlink" title="一个参数"></a>一个参数</h4><p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/Axios%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82/WechatIMG8.png" alt="cmd-markdown-logo"></p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/Axios%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82/WechatIMG9.png" alt="cmd-markdown-logo"></p>
<p>这个Request URL就是举例给我们后端需要我们怎么样的形式传过去，根据这个知道后端需要将参数直接加个?跟在路径后面，并且参数是string类型。</p>
<p>所以，api.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export const exportDisputeBook = data =&gt; axios.post(`$&#123;url&#125;/dispute/exportDisputeBook?text=$&#123;data&#125;`)</span><br></pre></td></tr></table></figure>

<p>调用的页面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">this.content = `&lt;html&gt;&lt;body&gt;&lt;h2 style=&quot;text-align: center;&quot;&gt;调解协议书&lt;/h2&gt;&lt;br /&gt;&lt;div&gt; &lt;h3&gt;$&#123;bodyApplicant&#125;&lt;/h3&gt; &lt;/div&gt;&lt;div&gt;&lt;h3&gt;$&#123;bodyRelative&#125;&lt;/h3&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;`</span><br><span class="line"></span><br><span class="line">Api.list.exportDisputeBook(this.content).then((res) =&gt; &#123;&#125;) // 这个this.content就是$&#123;data&#125;</span><br></pre></td></tr></table></figure>

<h4 id="多个参数"><a href="#多个参数" class="headerlink" title="多个参数"></a>多个参数</h4><p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/Axios%E6%8E%A5%E5%8F%A3%E8%AF%B7%E6%B1%82/WechatIMG10.png" alt="cmd-markdown-logo"></p>
<p>api.js:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export const saveDisputeBook = (disputeNo,data) =&gt; axios.post(`$&#123;url&#125;/dispute/saveDisputeBook?disputeNo=$&#123;disputeNo&#125;&amp;text=$&#123;data&#125;`)</span><br></pre></td></tr></table></figure>

<p>调用的页面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Api.list.saveDisputeBook(this.disputeNo,`&lt;html&gt;&lt;body&gt;$&#123;this.content&#125;&lt;/body&gt;&lt;/html&gt;`).then((res) =&gt; &#123;&#125;)  // 因为swagger写的是string,所以这两个参数直接这样传</span><br></pre></td></tr></table></figure>

<h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><p>参数跟头参一起传过去，就是请求接口时的Request Headers那里，一般在httpServer封装配置文件里面会设置。</p>
<p><a href="http://www.axios-js.com/zh-cn/docs/#%E4%BB%80%E4%B9%88%E6%98%AF-axios%EF%BC%9F" target="_blank" rel="noopener">axios官方文档</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg" alt="lzzhy">
            
              <p class="site-author-name" itemprop="name">lzzhy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://mail.aliyun.com/alimail/auth/login" target="_blank" title="联系邮箱地址 liting513@aliyun.com">
                      
                        <i class="fa fa-fw fa-envelope"></i>联系邮箱地址 liting513@aliyun.com</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lzzhy</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  








  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'rXKcXsdT3tD0mKixMEcxVfiQ-gzGzoHsz',
        appKey: 'Ol9qM6cCbzT0Guf70lWLjuBz',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
