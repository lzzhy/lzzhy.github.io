<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">










  <meta name="baidu-site-verification" content="true">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar1.jpeg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar1.jpeg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="Vue3 跟 Vite 正式版发布有很长一段时间了，生态圈也渐渐丰富起来。总结一下：就是快！也不用担心稳定性问题，开发体验真不是一般好！我们一起尝试从本文开始学习吧，从 0 开始手把手搭建一套基于 Vite + Vue3 + TypeScript 规范的前端工程化项目环境。 本文主要从以下几个方面展开来说：  架构搭建（后期规范后会整理成脚手架） 代码规范 提交规范  本项目完整代码托管在gith">
<meta property="og:type" content="article">
<meta property="og:title" content="vite+vue3+ts 从0开始搭建基础框架">
<meta property="og:url" content="https://lzzhy.cn/vite+vue3+ts 从0开始搭建基础框架/index.html">
<meta property="og:site_name" content="lzzhy Blog">
<meta property="og:description" content="Vue3 跟 Vite 正式版发布有很长一段时间了，生态圈也渐渐丰富起来。总结一下：就是快！也不用担心稳定性问题，开发体验真不是一般好！我们一起尝试从本文开始学习吧，从 0 开始手把手搭建一套基于 Vite + Vue3 + TypeScript 规范的前端工程化项目环境。 本文主要从以下几个方面展开来说：  架构搭建（后期规范后会整理成脚手架） 代码规范 提交规范  本项目完整代码托管在gith">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG34.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG35.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG36.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG33.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG37.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG38.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG39.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG40.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG41.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG42.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG43.png">
<meta property="og:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG44.png">
<meta property="og:updated_time" content="2021-06-03T10:46:01.950Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="vite+vue3+ts 从0开始搭建基础框架">
<meta name="twitter:description" content="Vue3 跟 Vite 正式版发布有很长一段时间了，生态圈也渐渐丰富起来。总结一下：就是快！也不用担心稳定性问题，开发体验真不是一般好！我们一起尝试从本文开始学习吧，从 0 开始手把手搭建一套基于 Vite + Vue3 + TypeScript 规范的前端工程化项目环境。 本文主要从以下几个方面展开来说：  架构搭建（后期规范后会整理成脚手架） 代码规范 提交规范  本项目完整代码托管在gith">
<meta name="twitter:image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG34.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://lzzhy.cn/vite+vue3+ts 从0开始搭建基础框架/">





  <title>vite+vue3+ts 从0开始搭建基础框架 | lzzhy Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">lzzhy Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">lzzhy的博客</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>





  <meta name="baidu-site-verification" content="V5nnDAPNHd">

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://lzzhy.cn/vite+vue3+ts 从0开始搭建基础框架/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="lzzhy">
      <meta itemprop="description" content>
      <meta itemprop="image" content="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lzzhy Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">vite+vue3+ts 从0开始搭建基础框架</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-30T16:52:40+08:00">
                2021-05-30
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/vite+vue3+ts 从0开始搭建基础框架/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/vite+vue3+ts 从0开始搭建基础框架/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  7.4k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Vue3 跟 Vite 正式版发布有很长一段时间了，生态圈也渐渐丰富起来。总结一下：就是快！也不用担心稳定性问题，开发体验真不是一般好！我们一起尝试从本文开始学习吧，从 0 开始手把手搭建一套基于 Vite + Vue3 + TypeScript 规范的前端工程化项目环境。</p>
<p>本文主要从以下几个方面展开来说：</p>
<ul>
<li>架构搭建（后期规范后会整理成脚手架）</li>
<li>代码规范</li>
<li>提交规范</li>
</ul>
<p>本项目完整代码托管在<a href="https://github.com/lzzhy/vue3-ts-ant-design" target="_blank" rel="noopener">github</a>上，欢迎有兴趣的同学去点亮小星星！！！</p>
<p>本文所用到的技术栈如下：</p>
<ul>
<li>编程语言：TypeScript 4.x + JavaScript</li>
<li>架构工具：Vite 2.x</li>
<li>前端框架：前端框架：Vue 3.x</li>
<li>路由工具：Vue Router 4.x</li>
<li>状态管理：Vuex 4.x</li>
<li>UI框架：ant design vue 2.x</li>
<li>CSS 预编译：less</li>
<li>HTTP 工具：Axios</li>
<li>Git Hook 工具：husky + lint-staged</li>
<li>代码规范：EditorConfig + Prettier + ESLint + Airbnb JavaScript Style Guide</li>
<li>提交规范：Commitizen + Commitlint</li>
</ul>
<p>好的，项目选型工作做好后，那就开始我们的Coding之旅吧。。。。</p>
<h2 id="架构搭建"><a href="#架构搭建" class="headerlink" title="架构搭建"></a>架构搭建</h2><h3 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h3><p>请确保你的电脑上成功安装 Node.js，本项目使用 Vite 构建工具，需要 Node.js 版本 &gt;= 12.0.0。</p>
<p>查看 Node.js 版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<p>建议将 Node.js 升级到最新的稳定版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 使用 nvm 安装最新稳定版 Node.js</span><br><span class="line">nvm install stable</span><br></pre></td></tr></table></figure>

<p>依赖用npm安装(cnpm的镜像源不同，安装出来的包也不一样)，版本要求6.以上</p>
<p>vue-cli 版本最好4.5以上（查看版本： vue -V，更新命令：npm install -g @vue/cli）(使用vue-cli时要求)</p>
<h3 id="使用-Vite-快速初始化项目雏形"><a href="#使用-Vite-快速初始化项目雏形" class="headerlink" title="使用 Vite 快速初始化项目雏形"></a>使用 Vite 快速初始化项目雏形</h3><p>使用NPM：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init @vitejs/app</span><br></pre></td></tr></table></figure>

<p>或者使用Yarn：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn create @vitejs/app</span><br></pre></td></tr></table></figure>

<p>然后按照终端提示完成操作，选择完后如下：（是不是炒鸡快！！！）</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG34.png" alt="cmd-markdown-logo"></p>
<p>你还可以通过附加的命令行选项直接指定项目名和模板，本项目要构建 Vite + Vue3 + TypeScript 项目，则运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># npm 6.x</span><br><span class="line">npm init @vitejs/app vite-vue3-ts --template vue-ts    // vite-vue3-ts是我的项目名称</span><br><span class="line"></span><br><span class="line"># npm 7+（需要额外的双横线）</span><br><span class="line">npm init @vitejs/app vite-vue3-ts -- --template vue-ts</span><br><span class="line"></span><br><span class="line"># yarn</span><br><span class="line">yarn create @vitejs/app vite-vue3-ts --template vue-ts</span><br></pre></td></tr></table></figure>

<p>完了后，cd vite-vue3-ts 可以看到生成的基础目录：</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG35.png" alt="cmd-markdown-logo"></p>
<p>安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>启动项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG36.png" alt="cmd-markdown-logo"></p>
<p>整个运行过程也是很快只用了不到1s。果然Vite速度没的说。。。</p>
<p>如上图，表示 Vite + Vue3 + TypeScript 简单的项目骨架搭建完毕，下面我们来为这个项目集成 Vue Router、Vuex、Ant Design Vue、Axios、Less。</p>
<h3 id="修改-Vite-配置文件"><a href="#修改-Vite-配置文件" class="headerlink" title="修改 Vite 配置文件"></a>修改 Vite 配置文件</h3><p>Vite 配置文件 <code>vite.config.ts</code> 位于根目录下，项目启动时会自动读取。</p>
<p>本项目先做一些简单配置，例如：设置 @ 指向 src 目录、 服务启动端口、打包路径、代理等。</p>
<p>关于 Vite 更多配置项及用法，请查看 Vite 官网 <a href="https://vitejs.dev/config/" target="_blank" rel="noopener">https://vitejs.dev/config/</a> 。</p>
<p>vite.config.ts：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import &#123; defineConfig &#125; from &quot;vite&quot;;</span><br><span class="line">import vue from &quot;@vitejs/plugin-vue&quot;;</span><br><span class="line">// 如果编辑器提示 path 模块找不到，则可以安装一下 @types/node -&gt; npm i @types/node -D</span><br><span class="line">import &#123; resolve &#125; from &quot;path&quot;;</span><br><span class="line"></span><br><span class="line">// https://vitejs.dev/config/</span><br><span class="line">export default defineConfig(&#123;</span><br><span class="line">  plugins: [vue()],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      &quot;@&quot;: resolve(__dirname, &quot;src&quot;), // 设置 `@` 指向 `src` 目录</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  base: &quot;./&quot;, // 设置打包路径</span><br><span class="line">  server: &#123;</span><br><span class="line">    port: 4000, // 设置服务启动端口号</span><br><span class="line">    open: true, // 设置服务启动时是否自动打开浏览器</span><br><span class="line">    cors: true, // 允许跨域</span><br><span class="line"></span><br><span class="line">    // 设置代理，根据我们项目实际情况配置</span><br><span class="line">    // proxy: &#123;</span><br><span class="line">    //   &apos;/api&apos;: &#123;</span><br><span class="line">    //     target: &apos;http://xxx.xxx.xxx.xxx:8000&apos;,</span><br><span class="line">    //     changeOrigin: true,</span><br><span class="line">    //     secure: false,</span><br><span class="line">    //     rewrite: (path) =&gt; path.replace(&apos;/api/&apos;, &apos;/&apos;)</span><br><span class="line">    //   &#125;</span><br><span class="line">    // &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="规范目录结构"><a href="#规范目录结构" class="headerlink" title="规范目录结构"></a>规范目录结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">├── publish/</span><br><span class="line">└── src/</span><br><span class="line">    ├── assets/                    // 静态资源目录</span><br><span class="line">    ├── common/                    // 通用类库目录</span><br><span class="line">    ├── components/                // 公共组件目录</span><br><span class="line">    ├── router/                    // 路由配置目录</span><br><span class="line">    ├── store/                     // 状态管理目录</span><br><span class="line">    ├── style/                     // 通用 CSS 目录</span><br><span class="line">    ├── utils/                     // 工具函数目录</span><br><span class="line">    ├── views/                     // 页面组件目录</span><br><span class="line">    ├── App.vue</span><br><span class="line">    ├── main.ts</span><br><span class="line">    ├── shims-vue.d.ts</span><br><span class="line">├── tests/                         // 单元测试目录</span><br><span class="line">├── index.html</span><br><span class="line">├── tsconfig.json                  // TypeScript 配置文件</span><br><span class="line">├── vite.config.ts                 // Vite 配置文件</span><br><span class="line">└── package.json</span><br></pre></td></tr></table></figure>

<h3 id="集成路由工具-Vue-Router"><a href="#集成路由工具-Vue-Router" class="headerlink" title="集成路由工具 Vue Router"></a>集成路由工具 Vue Router</h3><p>安装支持 Vue3 的路由工具 vue-router@4：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-router@4</span><br></pre></td></tr></table></figure>

<p>创建 src/router/index.ts 文件：（路由配置文件）<br>  在 src 下创建 router 目录，然后在 router 目录里新建 index.ts 文件</p>
<p>index.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  createRouter,</span><br><span class="line">  createWebHashHistory,</span><br><span class="line">  RouteRecordRaw,</span><br><span class="line">&#125; from &quot;vue-router&quot;;</span><br><span class="line">import Home from &quot;@/views/home.vue&quot;;</span><br><span class="line">import Vuex from &quot;@/views/vuex.vue&quot;;</span><br><span class="line"></span><br><span class="line">const routes: Array&lt;RouteRecordRaw&gt; = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/&quot;,</span><br><span class="line">    name: &quot;Home&quot;,</span><br><span class="line">    component: Home,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/vuex&quot;,</span><br><span class="line">    name: &quot;Vuex&quot;,</span><br><span class="line">    component: Vuex,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &quot;/axios&quot;,</span><br><span class="line">    name: &quot;Axios&quot;,</span><br><span class="line">    component: () =&gt; import(&quot;@/views/axios.vue&quot;), // 懒加载组件</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">const router = createRouter(&#123;</span><br><span class="line">  history: createWebHashHistory(),</span><br><span class="line">  routes,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default router;</span><br></pre></td></tr></table></figure>

<p>根据本项目路由配置的实际情况，需要在 src 下创建 views 目录，用来存储页面组件。并在 views 目录下创建 home.vue 、vuex.vue 、axios.vue。</p>
<p>在 <code>main.ts</code> 文件中挂载路由配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &quot;vue&quot;;</span><br><span class="line">import App from &quot;./App.vue&quot;;</span><br><span class="line"></span><br><span class="line">import router from &quot;./router/index&quot;;</span><br><span class="line"></span><br><span class="line">createApp(App).use(router).mount(&quot;#app&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="集成状态管理工具-Vuex"><a href="#集成状态管理工具-Vuex" class="headerlink" title="集成状态管理工具 Vuex"></a>集成状态管理工具 Vuex</h3><p>安装支持 Vue3 的状态管理工具 vuex@next</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vuex@next</span><br></pre></td></tr></table></figure>

<p>创建 src/store/index.ts 文件。在 src 下创建 store 目录，然后在 store 目录里新建 index.ts 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createStore &#125; from &quot;vuex&quot;;</span><br><span class="line"></span><br><span class="line">const defaultState = &#123;</span><br><span class="line">  count: 0,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// Create a new store instance.</span><br><span class="line">export default createStore(&#123;</span><br><span class="line">  state() &#123;</span><br><span class="line">    return defaultState;</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    increment(state: typeof defaultState) &#123;</span><br><span class="line">      state.count++;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    increment(context) &#123;</span><br><span class="line">      context.commit(&quot;increment&quot;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    double(state: typeof defaultState) &#123;</span><br><span class="line">      return 2 * state.count;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在 <code>main.ts</code> 文件中挂载 ant-design-vue 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &quot;vue&quot;;</span><br><span class="line">import App from &quot;./App.vue&quot;;</span><br><span class="line"></span><br><span class="line">import store from &quot;./store/index&quot;;</span><br><span class="line"></span><br><span class="line">createApp(App).use(store).mount(&quot;#app&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="项目创建-vue-cli"><a href="#项目创建-vue-cli" class="headerlink" title="项目创建 vue-cli"></a>项目创建 vue-cli</h3><p>以上那些是使用vite创建的流程，同时也可以使用vue-cli来进行创建，使用vue-cli时可以自行选择以上所需要的那些vue-router,vuex… vue-cli都已经集成了不需要大家在自己去写一次了。但是如果是第一次接触到vue3建议还是使用vite按照以上流程自己走一遍，能更好的明白vue3其中的一些配置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue create 项目名</span><br></pre></td></tr></table></figure>

<p>自定义选配置</p>
<p>新建项目时报错：</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG33.png" alt="cmd-markdown-logo"></p>
<p>解决方式：</p>
<ul>
<li>首先检查一下node、npm和vue-cli这些版本是不是需要的那些版本</li>
<li>重装依赖npm install</li>
</ul>
<h3 id="集成UI框架-ant-design-vue"><a href="#集成UI框架-ant-design-vue" class="headerlink" title="集成UI框架 ant design vue"></a>集成UI框架 ant design vue</h3><p>ant-design-vue只有2.以上版本才支持vue3</p>
<p>全局引入</p>
<p>安装支持vue3的ant design vue</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save ant-design-vue@next</span><br></pre></td></tr></table></figure>

<p>在 <code>main.ts</code> 文件中挂载 Vuex 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; createApp &#125; from &apos;vue&apos;;</span><br><span class="line">import Antd from &apos;ant-design-vue&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import &apos;ant-design-vue/dist/antd.css&apos;;</span><br><span class="line"></span><br><span class="line">const app = createApp();</span><br><span class="line">app.config.productionTip = false;</span><br><span class="line"></span><br><span class="line">app.use(Antd);</span><br></pre></td></tr></table></figure>

<p>在页面中能使用ant-design-vue组件的话就说明引入成功</p>
<p>【ant-design-vue官网】：<a href="https://2x.antdv.com/docs/vue/getting-started-cn" target="_blank" rel="noopener">https://2x.antdv.com/docs/vue/getting-started-cn</a></p>
<h3 id="集成-HTTP-工具-Axios"><a href="#集成-HTTP-工具-Axios" class="headerlink" title="集成 HTTP 工具 Axios"></a>集成 HTTP 工具 Axios</h3><p>安装 Axios（Axios 跟 Vue 版本没有直接关系，安装最新即可）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i axios</span><br></pre></td></tr></table></figure>

<p>配置 Axios</p>
<blockquote>
<p>为了使项目的目录结构合理且规范，我们在 src 下创建 utils 目录来存储我们常用的工具函数。</p>
</blockquote>
<p>Axios 作为 HTTP 工具，我们在 utils 目录下添加 axios.ts 文件 作为 Axios 配置文件：</p>
<p>axios.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import Axios from &quot;axios&quot;;</span><br><span class="line"></span><br><span class="line">const baseURL = &quot;域名&quot;;  // 如https://lzzhy.github.com</span><br><span class="line"></span><br><span class="line">const axios = Axios.create(&#123;</span><br><span class="line">  baseURL,</span><br><span class="line">  timeout: 20000, // 请求超时 20s</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 前置拦截器（发起请求之前的拦截）</span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">  (response) =&gt; &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 根据你的项目实际情况来对 config 做处理</span><br><span class="line">     * 这里对 config 不做任何处理，直接返回</span><br><span class="line">     */</span><br><span class="line">    return response;</span><br><span class="line">  &#125;,</span><br><span class="line">  (error) =&gt; &#123;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 后置拦截器（获取到响应时的拦截）</span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">  (response) =&gt; &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 根据你的项目实际情况来对 response 和 error 做处理</span><br><span class="line">     * 这里对 response 和 error 不做任何处理，直接返回</span><br><span class="line">     */</span><br><span class="line">    return response;</span><br><span class="line">  &#125;,</span><br><span class="line">  (error) =&gt; &#123;</span><br><span class="line">    if (error.response &amp;&amp; error.response.data) &#123;</span><br><span class="line">      const code = error.response.status;</span><br><span class="line">      const msg = error.response.data.message;</span><br><span class="line">      console.log(code,&apos;Message&apos;,msg)</span><br><span class="line">      console.error(`[Axios Error]`, error.response);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      console.log(&apos;error&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">    return Promise.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">export default axios;</span><br></pre></td></tr></table></figure>

<p>使用 Axios：在需要使用 Axios 文件里，引入 Axios 配置文件，参考如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;&lt;/template&gt;</span><br><span class="line">&lt;script lang=&quot;ts&quot;&gt;</span><br><span class="line">  import &#123; defineComponent &#125; from &quot;vue&quot;;</span><br><span class="line">  import axios from &quot;../utils/axios&quot;;</span><br><span class="line"></span><br><span class="line">  export default defineComponent(&#123;</span><br><span class="line">    setup() &#123;</span><br><span class="line">      axios</span><br><span class="line">        .get(&quot;/users/XPoet&quot;)</span><br><span class="line">        .then((res) =&gt; &#123;</span><br><span class="line">          console.log(&quot;res: &quot;, res);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch((err) =&gt; &#123;</span><br><span class="line">          console.log(&quot;err: &quot;, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="nginx-配置、域名映射"><a href="#nginx-配置、域名映射" class="headerlink" title="nginx 配置、域名映射"></a>nginx 配置、域名映射</h3><p>vue-cli生成的脚手架中vue2和vue3的环境配置和nginx配置都是一样的（使用vite的话需要注意：vue.config.js中有些需要用 VITE 开头）</p>
<p>当把axios导出后，我们接着就要去页面上请求接口了，但是发现直接访问后端给的接口访问不了，那可能是因为那个域名是后端本地的，因此我们需要进行域名的一个映射配置。（不走auth的）</p>
<p>需求：</p>
<ul>
<li>npm run serve项目跑起来后，浏览器需要映射到一个<code>域名</code>（控制台查看的接口请求地址的域名会跟浏览器那里的一样）</li>
<li>接口要请求成功，</li>
</ul>
<p>步骤如下：</p>
<p><code>配置etc/hosts</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br></pre></td></tr></table></figure>

<p>执行上面命令，根据提示输入电脑密码进入hosts。按 i 键进入编辑模式。</p>
<p>etc/hosts需要配置的两个东西：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">后端ip 后端的域名   // 如：10.11.1.7 bi.xxx.xxx.com</span><br><span class="line"></span><br><span class="line">自己本机的ip 映射的域名（必须）  //如：127.0.0.1 dev.xxx.xxx.com</span><br></pre></td></tr></table></figure>

<p>在hosts里面需要配置两个东西包括：</p>
<ul>
<li>配置后端的ip加上后端的域名（如数据地图：10.11.1.7 bi.open-ts.xxx.com）</li>
<li>配置自己本机的ip和映射的域名(这是必须的)（这个域名就是vue.config.js/devServer中的host，没有指定的时候可以自己取）：如数据地图 127.0.0.1 dev.map.xxx.com</li>
</ul>
<p>hosts配置完之后，ESC 退出编辑状态，输入 :wq 保存并退出vim</p>
<p><code>vue.config.js 配置</code>(这个文件要是没有就手动在根目录下添加)：</p>
<p>前端代码根目录下新建 vue.config.js 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    open: true,</span><br><span class="line">    host: &quot;dev.map.xxx.com&quot;, // 1.nginx配置的域名 2.也就是刚刚hosts里配置的本机映射的域名 3.也是项目跑起来后浏览器展示的域名（控制台查看接口请求也是这个域名）4.不加这个host的话默认是localhost:8080 （但实际上真正指向的地址是下面target只是这个不展示出来更安全）</span><br><span class="line">    port: 8091,  // 终端运行完显示的端口号，要跟nginx里的一样，npm run serve时就会找到这个端口号</span><br><span class="line">    https: false,</span><br><span class="line">    hotOnly: false,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      // 配置跨域</span><br><span class="line">      &quot;/api&quot;: &#123;  // 匹配到域名后的那个api就走这里, 要跟pathRewrite里一样</span><br><span class="line">        // 1.后端给的接口域名，swagger上的ip地址 2.控制台打开接口只是展示host那个，请求实际请求的是target这个地址</span><br><span class="line">        target: &quot;http://bi.open-ts.xxx.com&quot;,</span><br><span class="line">        ws: true,</span><br><span class="line">        changOrigin: true,</span><br><span class="line">        pathRewrite: &#123;</span><br><span class="line">          &quot;^/api&quot;: &quot;&quot;,    // 当匹配到域名后面是/api时用&quot;&quot;替代/api</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>nginx配置</code>：</p>
<p>cd进nginx的servers目录下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/etc/nginx/servers</span><br></pre></td></tr></table></figure>

<p>新建 .conf：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这个.conf就叫 vue.config.js/devserver/host的那个conf，如</span><br><span class="line"></span><br><span class="line">dev.map.xxx.com.conf</span><br></pre></td></tr></table></figure>

<p>进入这个.conf:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi xxxxxxxxx.conf</span><br></pre></td></tr></table></figure>

<p>在这个.conf里面添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 根据自己情况配置 </span><br><span class="line">    # 标注的是不用管的--&gt;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name dev.map.xxx.com;   // 跟vue.config.js/devserver/host一样，跟浏览器访问的路径一样</span><br><span class="line"></span><br><span class="line">    # 设置日志文件</span><br><span class="line">    access_log  /Users/qudian/Downloads/log/cdp.access.log;</span><br><span class="line">    error_log /Users/qudian/Downloads/log/cdp.error.log;</span><br><span class="line"></span><br><span class="line">     # 设定网站根目录</span><br><span class="line">    # root /home/apple/bi.dataphin/bi-dataphin-ui;</span><br><span class="line"></span><br><span class="line">    # 网站默认首页</span><br><span class="line">    # index index.php index.html index.htm;</span><br><span class="line"></span><br><span class="line">    client_max_body_size 20m;</span><br><span class="line">    fastcgi_buffers 8 16k;</span><br><span class="line">    fastcgi_buffer_size 32k;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:8091;  // 跟vue.config.js/devserver/port一样的端口号</span><br><span class="line">        # 用于配合 browserHistory</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="环境变量配置-见数据地图的配置"><a href="#环境变量配置-见数据地图的配置" class="headerlink" title="环境变量配置 (见数据地图的配置)"></a>环境变量配置 (见数据地图的配置)</h3><p>环境配置的作用其实就是统一管理不需要走ngix转发的（可以在本地直接访问的接口）域名，需要用到的时候直接拿到这个环境变量（如：VUE_APP_API_BASE_URL 直接加需要的接口名 + ‘lzzhy’）</p>
<p>如 .env.development（自己添加这个文件在根目录）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=development</span><br><span class="line">VUE_APP_PREVIEW=true</span><br><span class="line">#VUE_APP_API_BASE_URL=http://127.0.0.1:9999</span><br><span class="line">#VUE_APP_API_BASE_API=/api</span><br><span class="line">VUE_APP_API_BASE_URL=http://dev.cdp.xxx.com/api/sys/</span><br><span class="line">VUE_APP_BASE_URL=http://dev2.cdp.xxx.com:8091</span><br><span class="line"></span><br><span class="line">VUE_APP_SSO_SERVER=http://auth.test.qufenqi.com/</span><br><span class="line">VUE_APP_SSO_LOGIN_PATH=sso/login</span><br><span class="line">VUE_APP_SSO_APP_KEY=bi_cdp_sys</span><br><span class="line">VUE_APP_SSO_COOKIE_NAME=cdp-token</span><br></pre></td></tr></table></figure>

<h3 id="集成-CSS-预编译器-Stylus-Sass-Less"><a href="#集成-CSS-预编译器-Stylus-Sass-Less" class="headerlink" title="集成 CSS 预编译器 Stylus/Sass/Less"></a>集成 CSS 预编译器 Stylus/Sass/Less</h3><p>本项目使用 CSS 预编译器 less 内部已帮我们集成了相关的 loader，不需要额外配置。同理，你也可以使用 Sass 或 Stylus 等。</p>
<p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i less-loader less --save-dev</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;style lang=&quot;less&quot;&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>至此，一个基于 TypeScript + Vite + Vue3 + Vue Router + Vuex + Ant Design Vue + Axios + Stylus/Sass/Less 的前端项目开发环境搭建完毕，项目 Demo 托管在 <a href="https://github.com/lzzhy/vue3-ts-ant-design" target="_blank" rel="noopener">github</a> 仓库，需要的同学可以去下载下来，参考学习。</p>
<p>下面我们来打磨这个项目，增加代码规范约束、提交规范约束、单元测试、自动部署等，让其更完善、更健壮。</p>
<h2 id="代码规范"><a href="#代码规范" class="headerlink" title="代码规范"></a>代码规范</h2><p>随着前端应用逐渐变得大型化和复杂化，在同一个项目中有多个人员参与时，每个人的前端能力程度不等，他们往往会用不同的编码风格和习惯在项目中写代码，长此下去，势必会让项目的健壮性越来越差。解决这些问题，理论上讲，口头约定和代码审查都可以，但是这种方式无法实时反馈，而且沟通成本过高，不够灵活，更关键的是无法把控。不以规矩，不能成方圆，我们不得不在项目使用一些工具来约束代码规范。</p>
<p>本文讲解如何使用 EditorConfig + Prettier + ESLint 组合来实现代码规范化。</p>
<p>这样做带来好处：</p>
<ul>
<li>解决团队之间代码不规范导致的可读性差和可维护性差的问题。</li>
<li>解决团队成员不同编辑器导致的编码规范不统一问题。</li>
<li>提前发现代码风格问题，给出对应规范提示，及时修复。</li>
<li>减少代码审查过程中反反复复的修改过程，节约时间。</li>
<li>自动格式化，统一编码风格，从此和脏乱差的代码说再见</li>
</ul>
<h3 id="集成-EditorConfig-配置"><a href="#集成-EditorConfig-配置" class="headerlink" title="集成 EditorConfig 配置"></a>集成 EditorConfig 配置</h3><p>EditorConfig 有助于为不同 IDE 编辑器上处理同一项目的多个开发人员维护一致的编码风格</p>
<p>官网：<a href="http://editorconfig.org" target="_blank" rel="noopener">http://editorconfig.org</a></p>
<p>在项目根目录下增加 .editorconfig 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># Editor configuration, see http://editorconfig.org</span><br><span class="line"></span><br><span class="line"># 表示是最顶层的 EditorConfig 配置文件</span><br><span class="line">root = true</span><br><span class="line"></span><br><span class="line">[*] # 表示所有文件适用</span><br><span class="line">charset = utf-8 # 设置文件字符集为 utf-8</span><br><span class="line">indent_style = space # 缩进风格（tab | space）</span><br><span class="line">indent_size = 2 # 缩进大小</span><br><span class="line">end_of_line = lf # 控制换行类型(lf | cr | crlf)</span><br><span class="line">trim_trailing_whitespace = true # 去除行首的任意空白字符</span><br><span class="line">insert_final_newline = true # 始终在文件末尾插入一个新行</span><br><span class="line"></span><br><span class="line">[*.md] # 表示仅 md 文件适用以下规则</span><br><span class="line">max_line_length = off</span><br><span class="line">trim_trailing_whitespace = false</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li><p>VSCode 使用 EditorConfig 需要去插件市场下载插件 EditorConfig for VS Code</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG37.png" alt="cmd-markdown-logo"></p>
</li>
<li><p>JetBrains 系列（WebStorm、IntelliJ IDEA 等）则不用额外安装插件，可直接使用 EditorConfig 配置。</p>
</li>
</ul>
<h3 id="集成-Prettier-配置"><a href="#集成-Prettier-配置" class="headerlink" title="集成 Prettier 配置"></a>集成 Prettier 配置</h3><p>Prettier 是一款强大的代码格式化工具，支持 JavaScript、TypeScript、CSS、SCSS、Less、JSX、Angular、Vue、GraphQL、JSON、Markdown 等语言，基本上前端能用到的文件格式它都可以搞定，是当下最流行的代码格式化工具。</p>
<p>官网：<a href="https://prettier.io/" target="_blank" rel="noopener">https://prettier.io/</a></p>
<p>安装 Prettier</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i prettier -D</span><br></pre></td></tr></table></figure>

<p>创建 Prettier 配置文件,Prettier 支持多种格式的配置文件[27]，比如 .json、.yml、.yaml、.js等。在本项目根目录下创建 .prettierrc 文件。</p>
<p>.prettierrc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;useTabs&quot;: false,</span><br><span class="line">  &quot;tabWidth&quot;: 2,</span><br><span class="line">  &quot;printWidth&quot;: 100,</span><br><span class="line">  &quot;singleQuote&quot;: true,</span><br><span class="line">  &quot;trailingComma&quot;: &quot;none&quot;,</span><br><span class="line">  &quot;bracketSpacing&quot;: true,</span><br><span class="line">  &quot;semi&quot;: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Prettier 安装且配置好之后，就能使用命令来格式化代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 格式化所有文件（. 表示所有文件）</span><br><span class="line">npx prettier --write .</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ul>
<li><p>VSCode 编辑器使用 Prettier 配置需要下载插件 Prettier - Code formatter </p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG38.png" alt="cmd-markdown-logo"></p>
</li>
</ul>
<ul>
<li>JetBrains 系列编辑器（WebStorm、IntelliJ IDEA 等）则不用额外安装插件，可直接使用 Prettier 配置。</li>
</ul>
<p>Prettier 配置好以后，在使用 VSCode 或 WebStorm 等编辑器的格式化功能时，编辑器就会按照 Prettier 配置文件的规则来进行格式化，避免了因为大家编辑器配置不一样而导致格式化后的代码风格不统一的问题。</p>
<h3 id="集成-ESLint-配置"><a href="#集成-ESLint-配置" class="headerlink" title="集成 ESLint 配置"></a>集成 ESLint 配置</h3><p>正如前面我们提到的因团队成员之间编程能力和编码习惯不同所造成的代码质量问题，我们使用 ESLint 来解决，一边写代码一边查找问题，如果发现错误，就给出规则提示，并且自动修复，长期下去，可以促使团队成员往同一种编码风格靠拢。</p>
<p>安装 ESLint（推荐只在当前项目安装）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i eslint -D</span><br></pre></td></tr></table></figure>

<p>配置 ESLint：ESLint 安装成功后，执行 npx eslint –init，然后按照终端操作提示完成一系列设置来创建配置文件。</p>
<p>ESLint 为我们列出了三种社区流行的 JavaScript 风格指南，分别是 <a href="https://github.com/airbnb/javascript" target="_blank" rel="noopener">airbnb</a>、<a href="https://github.com/standard/standard" target="_blank" rel="noopener">airbnb</a>、Google。</p>
<p>这三份风格指南都是由众多大佬根据多年开发经验编写，足够优秀，全球很多大小公司都在使用。我们选用 GitHub 上 star 最多的 Airbnb，免去繁琐的配置 ESLint 规则时间，然后让团队成员去学习 Airbnb JavaScript 风格指南即可。</p>
<p>注： 在使用vue-cli安装项目时它内部有对eslint集成，会对ESlint提问也就是以上提供的三个选择，任选一个就行</p>
<p><code>这里作者不建议大家去自由配置 ESLint 规则，这三份 JavaScript 代码风格指南值得我们反复学习，掌握后，编程能力能上一大台阶。</code></p>
<p>在上面操作完成后，会在项目根目录下自动生成 .eslintrc.js 配置文件：</p>
<p>.eslintrc.js：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: true,</span><br><span class="line">    es2021: true,</span><br><span class="line">    node: true,</span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [&quot;plugin:vue/essential&quot;, &quot;airbnb-base&quot;],</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    ecmaVersion: 12,</span><br><span class="line">    parser: &quot;@typescript-eslint/parser&quot;,</span><br><span class="line">    sourceType: &quot;module&quot;,</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [&quot;vue&quot;, &quot;@typescript-eslint&quot;],</span><br><span class="line">  rules: &#123;&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>根据项目实际情况，如果我们有额外的 ESLint 规则，也在此文件中追加。</p>
<p>注意：</p>
<ul>
<li><p>VSCode 使用 ESLint 配置文件需要去插件市场下载插件 ESLint<br><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG39.png" alt="cmd-markdown-logo"></p>
</li>
<li><p>JetBrains 系列（WebStorm、IntelliJ IDEA 等）则不用额外安装插件</p>
</li>
</ul>
<p>现在编辑器已经给出错误提示和修复方案，但需要我们一个一个去点击修复，还是挺麻烦的。很简单，我们只需设置编辑器保存文件时自动执行 eslint –fix 命令进行代码风格修复。</p>
<p>VSCode 在 settings.json 设置文件中，增加以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;editor.codeActionsOnSave&quot;: &#123;</span><br><span class="line">    &quot;source.fixAll.eslint&quot;: true</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="解决-Prettier-和-ESLint-的冲突"><a href="#解决-Prettier-和-ESLint-的冲突" class="headerlink" title="解决 Prettier 和 ESLint 的冲突"></a>解决 Prettier 和 ESLint 的冲突</h3><p>实际项目中的 ESLint 和 Prettier 配置规则，难免会存在规则冲突情况。</p>
<p>解决两者冲突问题，需要用到 eslint-plugin-prettier 和 eslint-config-prettier</p>
<ul>
<li>eslint-plugin-prettier 将 Prettier 的规则设置到 ESLint 的规则中</li>
<li>eslint-config-prettier 关闭 ESLint 中与 Prettier 中会发生冲突的规则</li>
</ul>
<p>最后形成优先级：Prettier 配置规则 &gt; ESLint 配置规则</p>
<p>安装插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i eslint-plugin-prettier eslint-config-prettier -D</span><br></pre></td></tr></table></figure>

<p>在 .eslintrc.js 添加 prettier 插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  ...</span><br><span class="line">  extends: [</span><br><span class="line">    &apos;plugin:vue/essential&apos;,</span><br><span class="line">    &apos;airbnb-base&apos;,</span><br><span class="line">    &apos;plugin:prettier/recommended&apos; // 添加 prettier 插件</span><br><span class="line">  ],</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们在执行 eslint –fix 命令时，ESLint 就会按照 Prettier 的配置规则来格式化代码，轻松解决二者冲突问题。</p>
<h3 id="集成-husky-和-lint-staged"><a href="#集成-husky-和-lint-staged" class="headerlink" title="集成 husky 和 lint-staged"></a>集成 husky 和 lint-staged</h3><p>我们还需要做一些限制，让没通过 ESLint 检测和修复的代码禁止提交，从而保证仓库代码都是符合规范的。</p>
<p>为了解决这个问题，我们需要用到 Git Hook，在本地执行 git commit 的时候，就对所提交的代码进行 ESLint 检测和修复（即执行 eslint –fix），如果这些代码没通过 ESLint 规则校验，则禁止提交。</p>
<p>实现这一功能，我们借助 husky + lint-staged</p>
<blockquote>
<p>husky —— Git Hook 工具，可以设置在 git 各个阶段（pre-commit、commit-msg、pre-push 等）触发我们的命令。</p>
<p>lint-staged —— 在 git 暂存的文件上运行 linters。</p>
</blockquote>
<h4 id="配置-husky-自动配置"><a href="#配置-husky-自动配置" class="headerlink" title="配置 husky (自动配置)"></a>配置 husky (自动配置)</h4><p>使用 husky-init 命令快速在项目初始化一个 husky 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky-init &amp;&amp; npm install</span><br></pre></td></tr></table></figure>

<blockquote>
<p>特别注意：本项目使用 husky 6.x 版本，6.x 版本配置方式跟之前的版本有较大差异。目前网上大部分有关 husky 的教程都是 6 以前的版本 ，跟本文教程不太一样，当发现配置方法不一致时，一切以 husky 官网为准。</p>
</blockquote>
<p>到这里，husky 配置完毕，现在我们来使用它</p>
<p>husky 包含很多 hook（钩子），常用有：pre-commit、commit-msg、pre-push。这里，我们使用 pre-commit 来触发 ESLint 命令。</p>
<p>修改 .husky/pre-commit hook 文件的触发命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eslint --fix ./src --ext .vue,.js,.ts</span><br></pre></td></tr></table></figure>

<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG40.png" alt="cmd-markdown-logo"></p>
<p>上面这个 pre-commit hook 文件的作用是：当我们执行 git commit -m “xxx” 时，会先对 src 目录下所有的 .vue、.js、.ts 文件执行 eslint –fix 命令，如果 ESLint 通过，成功 commit，否则终止 commit。</p>
<p>但是又存在一个问题：有时候我们明明只改动了一两个文件，却要对所有的文件执行 eslint –fix。假如这是一个历史项目，我们在中途配置了 ESLint 规则，那么在提交代码时，也会对其他未修改的“历史”文件都进行检查，可能会造成大量文件出现 ESLint 错误，显然不是我们想要的结果。</p>
<p>我们要做到只用 ESLint 修复自己此次写的代码，而不去影响其他的代码。所以我们还需借助一个神奇的工具 lint-staged 。</p>
<h4 id="配置-lint-staged"><a href="#配置-lint-staged" class="headerlink" title="配置 lint-staged"></a>配置 lint-staged</h4><p>lint-staged 这个工具一般结合 husky 来使用，它可以让 husky 的 hook 触发的命令只作用于 git add那些文件（即 git 暂存区的文件），而不会影响到其他文件。</p>
<p>接下来，我们使用 lint-staged 继续优化项目。</p>
<p>安装 lint-staged</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i lint-staged -D</span><br></pre></td></tr></table></figure>

<p>在 package.json里增加 lint-staged 配置项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;lint-staged&quot;: &#123;</span><br><span class="line">  &quot;*.&#123;vue,js,ts&#125;&quot;: &quot;eslint --fix&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG41.png" alt="cmd-markdown-logo"></p>
<p>这行命令表示：只对 git 暂存区的 .vue、.js、.ts 文件执行 eslint –fix</p>
<p>修改 .husky/pre-commit hook 的触发命令为：npx lint-staged</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG42.png" alt="cmd-markdown-logo"></p>
<p>至此，husky 和 lint-staged 组合配置完成</p>
<p>最后提交代码时就只会对当前提交的这些代码commit时进行校验，符合eslint则提交不符合则报错。</p>
<h2 id="提交规范"><a href="#提交规范" class="headerlink" title="提交规范"></a>提交规范</h2><p>多人协作的项目中，在提交代码这个环节，也存在一种情况：不能保证每个人对提交信息的准确描述，因此会出现提交信息紊乱、风格不一致的情况。</p>
<p>这里，我们使用社区最流行、最知名、最受认可的 Angular 团队提交规范。如：</p>
<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG43.png" alt="cmd-markdown-logo"></p>
<p>那我们的话就大致统一一下就不分的这么细了：</p>
<table>
<thead>
<tr>
<th>值</th>
<th align="right">描述</th>
</tr>
</thead>
<tbody><tr>
<td>feat</td>
<td align="right">新增一个功能</td>
</tr>
<tr>
<td>fix</td>
<td align="right">修复一个 Bug</td>
</tr>
<tr>
<td>docs</td>
<td align="right">文档变更</td>
</tr>
<tr>
<td>style</td>
<td align="right">代码格式（不影响功能，例如空格、分号等格式修正）</td>
</tr>
<tr>
<td>refactor</td>
<td align="right">代码重构</td>
</tr>
<tr>
<td>perf</td>
<td align="right">改善性能</td>
</tr>
<tr>
<td>test</td>
<td align="right">测试</td>
</tr>
<tr>
<td>build</td>
<td align="right">变更项目构建或外部依赖（例如 scopes: webpack、gulp、npm 等）</td>
</tr>
<tr>
<td>ci</td>
<td align="right">更改持续集成软件的配置文件和 package 中的 scripts 命令，例如 scopes: Travis, Circle 等</td>
</tr>
<tr>
<td>chore</td>
<td align="right">变更构建流程或辅助工具</td>
</tr>
<tr>
<td>revert</td>
<td align="right">代码回退</td>
</tr>
</tbody></table>
<p>当我们在commit时要是真的按照上面这些来执行的话，肯定头都晕了。那么就有插件来帮我们完成了啦啦啦啦。。。。</p>
<p>是的，就是 Commitizen</p>
<h4 id="集成-Commitizen-实现规范提交"><a href="#集成-Commitizen-实现规范提交" class="headerlink" title="集成 Commitizen 实现规范提交"></a>集成 Commitizen 实现规范提交</h4><p>我们使用 Commitizen 工具来帮助我们自动生成 commit message 格式，从而实现规范提交。</p>
<blockquote>
<p>Commitizen 是一个帮助撰写规范 commit message 的工具。它有一个命令行工具 cz-cli。</p>
</blockquote>
<p>安装 Commitizen</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install commitizen -D</span><br></pre></td></tr></table></figure>


<p>成功安装 Commitizen 后，我们用 cz-conventional-changelog 适配器来初始化项目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx commitizen init cz-conventional-changelog --save-dev --save-exact</span><br></pre></td></tr></table></figure>

<p>使用 Commitizen：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 以前我们提交代码都是 git commit -m &quot;xxx&quot;，现在改为 git cz，然后按照终端操作提示，逐步填入信息，就能自动生成规范的 commit message。 --&gt;</span><br><span class="line"></span><br><span class="line">git cz</span><br></pre></td></tr></table></figure>


<p>最后，在 Git 提交历史中就能看到刚刚规范的提交记录了</p>
<h4 id="自定义配置提交说明"><a href="#自定义配置提交说明" class="headerlink" title="自定义配置提交说明"></a>自定义配置提交说明</h4><p>上面这个 git cz 终端操作提示都是英文的，如果想改成中文的或者自定义这些配置选项，我们使用 cz-customizable 适配器。</p>
<p>运行如下命令使用 cz-customizable 初始化项目，注意之前已经初始化过一次，这次再初始化，需要加 –force 覆盖。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx commitizen init cz-customizable --save-dev --save-exact --force</span><br></pre></td></tr></table></figure>

<p>在项目根目录下创建 .cz-config.js 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  // type 类型（定义之后，可通过上下键选择）</span><br><span class="line">  types: [</span><br><span class="line">    &#123; value: &apos;feat&apos;, name: &apos;feat:     新增功能&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;fix&apos;, name: &apos;fix:      修复 bug&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;docs&apos;, name: &apos;docs:     文档变更&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;style&apos;, name: &apos;style:    代码格式（不影响功能，例如空格、分号等格式修正）&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;refactor&apos;, name: &apos;refactor: 代码重构（不包括 bug 修复、功能新增）&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;perf&apos;, name: &apos;perf:     性能优化&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;test&apos;, name: &apos;test:     添加、修改测试用例&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;build&apos;, name: &apos;build:    构建流程、外部依赖变更（如升级 npm 包、修改 webpack 配置等）&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;ci&apos;, name: &apos;ci:       修改 CI 配置、脚本&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;chore&apos;, name: &apos;chore:    对构建过程或辅助工具和库的更改（不影响源文件、测试用例）&apos; &#125;,</span><br><span class="line">    &#123; value: &apos;revert&apos;, name: &apos;revert:   回滚 commit&apos; &#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">  // scope 类型（定义之后，可通过上下键选择）</span><br><span class="line">  scopes: [</span><br><span class="line">    [&apos;components&apos;, &apos;组件相关&apos;],</span><br><span class="line">    [&apos;hooks&apos;, &apos;hook 相关&apos;],</span><br><span class="line">    [&apos;utils&apos;, &apos;utils 相关&apos;],</span><br><span class="line">    [&apos;element-ui&apos;, &apos;对 element-ui 的调整&apos;],</span><br><span class="line">    [&apos;styles&apos;, &apos;样式相关&apos;],</span><br><span class="line">    [&apos;deps&apos;, &apos;项目依赖&apos;],</span><br><span class="line">    [&apos;auth&apos;, &apos;对 auth 修改&apos;],</span><br><span class="line">    [&apos;other&apos;, &apos;其他修改&apos;],</span><br><span class="line">    // 如果选择 custom，后面会让你再输入一个自定义的 scope。也可以不设置此项，把后面的 allowCustomScopes 设置为 true</span><br><span class="line">    [&apos;custom&apos;, &apos;以上都不是？我要自定义&apos;]</span><br><span class="line">  ].map(([value, description]) =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      value,</span><br><span class="line">      name: `$&#123;value.padEnd(30)&#125; ($&#123;description&#125;)`</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  // 是否允许自定义填写 scope，在 scope 选择的时候，会有 empty 和 custom 可以选择。</span><br><span class="line">  // allowCustomScopes: true,</span><br><span class="line"></span><br><span class="line">  // allowTicketNumber: false,</span><br><span class="line">  // isTicketNumberRequired: false,</span><br><span class="line">  // ticketNumberPrefix: &apos;TICKET-&apos;,</span><br><span class="line">  // ticketNumberRegExp: &apos;\\d&#123;1,5&#125;&apos;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  // 针对每一个 type 去定义对应的 scopes，例如 fix</span><br><span class="line">  /*</span><br><span class="line">  scopeOverrides: &#123;</span><br><span class="line">    fix: [</span><br><span class="line">      &#123; name: &apos;merge&apos; &#125;,</span><br><span class="line">      &#123; name: &apos;style&apos; &#125;,</span><br><span class="line">      &#123; name: &apos;e2eTest&apos; &#125;,</span><br><span class="line">      &#123; name: &apos;unitTest&apos; &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  */</span><br><span class="line"></span><br><span class="line">  // 交互提示信息</span><br><span class="line">  messages: &#123;</span><br><span class="line">    type: &apos;确保本次提交遵循 Angular 规范！\n选择你要提交的类型：&apos;,</span><br><span class="line">    scope: &apos;\n选择一个 scope（可选）：&apos;,</span><br><span class="line">    // 选择 scope: custom 时会出下面的提示</span><br><span class="line">    customScope: &apos;请输入自定义的 scope：&apos;,</span><br><span class="line">    subject: &apos;填写简短精炼的变更描述：\n&apos;,</span><br><span class="line">    body:</span><br><span class="line">      &apos;填写更加详细的变更描述（可选）。使用 &quot;|&quot; 换行：\n&apos;,</span><br><span class="line">    breaking: &apos;列举非兼容性重大的变更（可选）：\n&apos;,</span><br><span class="line">    footer: &apos;列举出所有变更的 ISSUES CLOSED（可选）。 例如: #31, #34：\n&apos;,</span><br><span class="line">    confirmCommit: &apos;确认提交？&apos;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  // 设置只有 type 选择了 feat 或 fix，才询问 breaking message</span><br><span class="line">  allowBreakingChanges: [&apos;feat&apos;, &apos;fix&apos;],</span><br><span class="line"></span><br><span class="line">  // 跳过要询问的步骤</span><br><span class="line">  // skipQuestions: [&apos;body&apos;, &apos;footer&apos;],</span><br><span class="line"></span><br><span class="line">  // subject 限制长度</span><br><span class="line">  subjectLimit: 100,</span><br><span class="line">  breaklineChar: &apos;|&apos;, // 支持 body 和 footer</span><br><span class="line">  // footerPrefix : &apos;ISSUES CLOSED:&apos;</span><br><span class="line">  // askForBreakingChangeFirst : true,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="集成-commitlint-验证提交规范"><a href="#集成-commitlint-验证提交规范" class="headerlink" title="集成 commitlint 验证提交规范"></a>集成 commitlint 验证提交规范</h4><p>提交代码这个环节，我们也增加一个限制：只让符合 Angular 规范的 commit message 通过</p>
<p>1.安装 commitlint</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i @commitlint/config-conventional @commitlint/cli -D</span><br></pre></td></tr></table></figure>

<p>2.配置 commitlint</p>
<p>在项目根目录下创建 commitlint.config.js 文件，并填入以下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123; extends: [&quot;@commitlint/config-conventional&quot;] &#125;;</span><br></pre></td></tr></table></figure>

<p>3.使用 husky 的 commit-msg hook 触发验证提交信息的命令</p>
<p>我们使用 husky 命令在 .husky 目录下创建 commit-msg 文件，并在此执行 commit message 的验证命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx husky add .husky/commit-msg &quot;npx --no-install commitlint --edit $1&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/vite%2Bvue3%2Bts/WechatIMG44.png" alt="cmd-markdown-logo"></p>
<p>最后commitlint 验证，提交信息 test commitlint 符合规范则成功提交到仓库，不符合提示失败</p>
<p>因为已在项目中集成 commitizen，建议大家用 git cz 来代替 git commit 提交代码，可以保证提交信息规范。</p>
<h4 id="如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）"><a href="#如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）" class="headerlink" title="如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）"></a>如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）</h4><p>全局设置 commit-msg 是放在全局目录下的：</p>
<p>创建文件夹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ~/.git_template/hooks</span><br></pre></td></tr></table></figure>

<p>在~/.git_template/hooks文件夹中添加 commit-msg 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> #!/bin/sh</span><br><span class="line"> MSG=`awk &apos;&#123;printf(&quot;%s&quot;,$0)&#125;&apos; $1`</span><br><span class="line"> if [[ $MSG =~ ^(feat|fix|test|refactor|docs|style|chroe)(\(.*\))?:[[:space:]](.+)$</span><br><span class="line">]] then</span><br><span class="line">     echo -e &quot;\033[32m commit success! \033[0m&quot;</span><br><span class="line"> else</span><br><span class="line">     echo -e &quot;\033[31m Error: the commit message is irregular \033[m&quot;</span><br><span class="line">     echo -e &quot;\033[31m Error: type must be one of [feat,fix,docs,style,refactor,tes</span><br><span class="line"> t,chore] \033[m&quot;</span><br><span class="line">     echo -e &quot;\033[31m eg: feat(user): add the user login \033[m&quot;</span><br><span class="line">exit 1 fi</span><br></pre></td></tr></table></figure>

<p>设置全局配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global init.templatedir ~/.git_tempalte</span><br></pre></td></tr></table></figure>

<p>这样全局设置后，创建新的使用git管理的项目的时候自动会将全局的模板拷贝至</p>
<h3 id="项目业务开发"><a href="#项目业务开发" class="headerlink" title="项目业务开发"></a>项目业务开发</h3><h3 id="组件封装（针对项目实际抽出公共组件慢慢剥离）"><a href="#组件封装（针对项目实际抽出公共组件慢慢剥离）" class="headerlink" title="组件封装（针对项目实际抽出公共组件慢慢剥离）"></a>组件封装（针对项目实际抽出公共组件慢慢剥离）</h3><h3 id="全局样式（包括色值，样式）"><a href="#全局样式（包括色值，样式）" class="headerlink" title="全局样式（包括色值，样式）"></a>全局样式（包括色值，样式）</h3>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/性能优化/" rel="next" title="性能优化">
                <i class="fa fa-chevron-left"></i> 性能优化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Vue2 Vue3相对比/" rel="prev" title="Vue2 Vue3相对比">
                Vue2 Vue3相对比 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="https://lzzhy.oss-cn-beijing.aliyuncs.com/blog/avatar.jpeg" alt="lzzhy">
            
              <p class="site-author-name" itemprop="name">lzzhy</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://mail.aliyun.com/alimail/auth/login" target="_blank" title="联系邮箱地址 liting513@aliyun.com">
                      
                        <i class="fa fa-fw fa-envelope"></i>联系邮箱地址 liting513@aliyun.com</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#架构搭建"><span class="nav-number">1.</span> <span class="nav-text">架构搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#环境要求"><span class="nav-number">1.1.</span> <span class="nav-text">环境要求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-Vite-快速初始化项目雏形"><span class="nav-number">1.2.</span> <span class="nav-text">使用 Vite 快速初始化项目雏形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改-Vite-配置文件"><span class="nav-number">1.3.</span> <span class="nav-text">修改 Vite 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#规范目录结构"><span class="nav-number">1.4.</span> <span class="nav-text">规范目录结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成路由工具-Vue-Router"><span class="nav-number">1.5.</span> <span class="nav-text">集成路由工具 Vue Router</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成状态管理工具-Vuex"><span class="nav-number">1.6.</span> <span class="nav-text">集成状态管理工具 Vuex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#项目创建-vue-cli"><span class="nav-number">1.7.</span> <span class="nav-text">项目创建 vue-cli</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成UI框架-ant-design-vue"><span class="nav-number">1.8.</span> <span class="nav-text">集成UI框架 ant design vue</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成-HTTP-工具-Axios"><span class="nav-number">1.9.</span> <span class="nav-text">集成 HTTP 工具 Axios</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nginx-配置、域名映射"><span class="nav-number">1.10.</span> <span class="nav-text">nginx 配置、域名映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#环境变量配置-见数据地图的配置"><span class="nav-number">1.11.</span> <span class="nav-text">环境变量配置 (见数据地图的配置)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成-CSS-预编译器-Stylus-Sass-Less"><span class="nav-number">1.12.</span> <span class="nav-text">集成 CSS 预编译器 Stylus/Sass/Less</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#代码规范"><span class="nav-number">2.</span> <span class="nav-text">代码规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#集成-EditorConfig-配置"><span class="nav-number">2.1.</span> <span class="nav-text">集成 EditorConfig 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成-Prettier-配置"><span class="nav-number">2.2.</span> <span class="nav-text">集成 Prettier 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成-ESLint-配置"><span class="nav-number">2.3.</span> <span class="nav-text">集成 ESLint 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决-Prettier-和-ESLint-的冲突"><span class="nav-number">2.4.</span> <span class="nav-text">解决 Prettier 和 ESLint 的冲突</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#集成-husky-和-lint-staged"><span class="nav-number">2.5.</span> <span class="nav-text">集成 husky 和 lint-staged</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置-husky-自动配置"><span class="nav-number">2.5.1.</span> <span class="nav-text">配置 husky (自动配置)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#配置-lint-staged"><span class="nav-number">2.5.2.</span> <span class="nav-text">配置 lint-staged</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#提交规范"><span class="nav-number">3.</span> <span class="nav-text">提交规范</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#集成-Commitizen-实现规范提交"><span class="nav-number">3.0.1.</span> <span class="nav-text">集成 Commitizen 实现规范提交</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义配置提交说明"><span class="nav-number">3.0.2.</span> <span class="nav-text">自定义配置提交说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#集成-commitlint-验证提交规范"><span class="nav-number">3.0.3.</span> <span class="nav-text">集成 commitlint 验证提交规范</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）"><span class="nav-number">3.0.4.</span> <span class="nav-text">如果觉得前面三个过于繁琐，可以试下下面这个（缺点，需要在每个开发的电脑中配置）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#项目业务开发"><span class="nav-number">3.1.</span> <span class="nav-text">项目业务开发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组件封装（针对项目实际抽出公共组件慢慢剥离）"><span class="nav-number">3.2.</span> <span class="nav-text">组件封装（针对项目实际抽出公共组件慢慢剥离）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全局样式（包括色值，样式）"><span class="nav-number">3.3.</span> <span class="nav-text">全局样式（包括色值，样式）</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lzzhy</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  








  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'rXKcXsdT3tD0mKixMEcxVfiQ-gzGzoHsz',
        appKey: 'Ol9qM6cCbzT0Guf70lWLjuBz',
        placeholder: 'Just go go',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
